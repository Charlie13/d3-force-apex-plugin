function net_gobrechts_d3_force(o,n,e,t){"use strict";function r(o){var n;if(a.tools.triggerApexEvent(document.querySelector("#"+a.conf.domContainerId),"apexbeforerefresh"),a.conf.customize?a.tools.customizeChart():d3.select("#"+a.conf.domContainerId+"_customizing").remove(),o||a.data.rawDataString?o&&(a.conf.sampleData=!1):(a.tools.logError("Houston, we have a problem - we have to provide sample data."),a.conf.sampleData=!0,o=a.data.sampleData),o){if("<"==o.trim().substr(0,1))try{a.data.rawDataString=a.tools.x2js.xml_str2json(o),null===a.data.rawDataString&&(n="Unable to convert XML data.",a.tools.logError(n),a.data.rawDataString={data:{nodes:[{ID:"1",LABEL:"ERROR: "+n,COLORVALUE:"1",SIZEVALUE:"1"}],links:[]}})}catch(e){n="Unable to convert XML data: "+e.message+".",a.tools.logError(n),a.data.rawDataString={data:{nodes:[{ID:"1",LABEL:"ERROR: "+n,COLORVALUE:"1",SIZEVALUE:"1"}],links:[]}}}else if("{"==o.trim().substr(0,1))try{a.data.rawDataString=JSON.parse(o)}catch(e){n="Unable to parse JSON data: "+e.message+".",a.tools.logError(n),a.data.rawDataString={data:{nodes:[{ID:"1",LABEL:"ERROR: "+n,COLORVALUE:"1",SIZEVALUE:"1"}],links:[]}}}else n='Your data is not starting with "<" or "{" - parsing not possible.',a.tools.logError(n),a.data.rawDataString={data:{nodes:[{ID:"1",LABEL:"ERROR: "+n,COLORVALUE:"1",SIZEVALUE:"1"}],links:[]}};a.tools.log("Raw data string:"),a.tools.log(o,!0),a.tools.log("Converted JSON object:"),a.tools.log(a.data.rawDataString,!0),a.data.hasOwnProperty("rawDataString")&&null!==a.data.rawDataString?a.data.rawDataString.hasOwnProperty("data")&&null!==a.data.rawDataString.data?(a.data.rawDataString.data.hasOwnProperty("nodes")&&null!==a.data.rawDataString.data.nodes?(a.data.nodes=a.data.rawDataString.data.nodes,0==a.data.nodes.length&&(n="Your data contains an empty nodes array.",a.tools.logError(n),a.data.nodes=[{ID:"1",LABEL:"ERROR: "+n,COLORVALUE:"1",SIZEVALUE:"1"}])):(n="Your data contains no nodes.",a.tools.logError(n),a.data.nodes=[{ID:"1",LABEL:"ERROR: "+n,COLORVALUE:"1",SIZEVALUE:"1"}]),a.data.links=a.data.rawDataString.data.hasOwnProperty("links")&&null!==a.data.rawDataString.data.links?a.data.rawDataString.data.links:[]):(n="Missing root element named data.",a.tools.logError(n),a.data={nodes:[{ID:"1",LABEL:"ERROR: "+n,COLORVALUE:"1",SIZEVALUE:"1"}],links:[]}):(n="Unable to parse your data.",a.tools.logError(n),a.data={nodes:[{ID:"1",LABEL:"ERROR: "+n,COLORVALUE:"1",SIZEVALUE:"1"}],links:[]}),a.data.id_lookup=[],a.data.nodes.forEach(function(o,n){o.SIZEVALUE=parseFloat(o.SIZEVALUE),o.index=n,o.LABELCIRCULAR=!!o.LABELCIRCULAR,a.data.id_lookup[o.ID]=o}),a.data.links.forEach(function(o){o.source=a.data.id_lookup[o.FROMID],o.target=a.data.id_lookup[o.TOID]}),a.data.links=a.data.links.filter(function(o){return"undefined"!=typeof o.source&&"undefined"!=typeof o.target}),a.data.neighbors=a.data.links.map(function(o){return o.FROMID+":"+o.TOID})}if(a.conf.domSvg.classed("border",a.conf.showBorder),"color20"==a.conf.colorScheme?a.tools.color=d3.scale.category20():"color20b"==a.conf.colorScheme?a.tools.color=d3.scale.category20b():"color20c"==a.conf.colorScheme?a.tools.color=d3.scale.category20c():"color10"==a.conf.colorScheme?a.tools.color=d3.scale.category10():"direct"==a.conf.colorScheme?a.tools.color=function(o){return o}:(a.conf.colorScheme="color20",a.tools.color=d3.scale.category20()),a.conf.positions){var t=0;a.conf.positions.forEach(function(o){void 0!==a.data.id_lookup[o.ID]&&(a.data.id_lookup[o.ID].x=o.x,a.data.id_lookup[o.ID].y=o.y,a.data.id_lookup[o.ID].px=o.x,a.data.id_lookup[o.ID].py=o.y,a.data.id_lookup[o.ID].fixed=o.fixed,1==o.fixed&&t++)}),t>0&&(a.conf.pinMode=!0),a.conf.positions=null}else a.conf.domSvg.selectAll("circle.node").data(a.data.nodes,function(o){return a.conf.domContainerId+"_"+o.ID}).each(function(o){a.data.id_lookup[o.ID].x=parseFloat(d3.select(this).attr("cx")),a.data.id_lookup[o.ID].y=parseFloat(d3.select(this).attr("cy"))});a.tools.radius=d3.scale.sqrt().range([a.conf.minNodeRadius,a.conf.maxNodeRadius]).domain(d3.extent(a.data.nodes,function(o){return parseFloat(o.SIZEVALUE)})),a.data.nodes.forEach(function(o){o.radius=a.tools.radius(o.SIZEVALUE),!a.conf.pinMode&&o.fixed&&(o.fixed=!1)}),a.links=a.conf.domSvg.selectAll("line.link").data(a.data.links.filter(function(o){return o.FROMID!=o.TOID}),function(o){return a.conf.domContainerId+"_link_"+o.FROMID+"_"+o.TOID}).style("marker-end",a.conf.showLinkDirection?"url(#"+a.conf.domContainerId+"_normalTriangle)":null).classed("dashed",function(o){return"dashed"===o.STYLE}),a.links.enter().append("svg:line").attr("id",function(o){return a.conf.domContainerId+"_link_"+o.FROMID+"_"+o.TOID}).attr("class","link").style("marker-end",a.conf.showLinkDirection?"url(#"+a.conf.domContainerId+"_normalTriangle)":null).classed("dashed",function(o){return"dashed"===o.STYLE}),a.links.exit().remove(),a.selfLinks=a.conf.domSvg.selectAll("path.link").data(a.data.links.filter(function(o){return o.FROMID==o.TOID&&a.conf.showSelfLinks}),function(o){return a.conf.domContainerId+"_link_"+o.FROMID+"_"+o.TOID}).attr("d",function(o){return a.tools.getSelfLinkPath(o)}).style("marker-end",a.conf.showLinkDirection?"url(#"+a.conf.domContainerId+"_normalTriangle)":null).classed("dashed",function(o){return"dashed"==o.STYLE}),a.selfLinks.enter().append("svg:path").attr("id",function(o){return a.conf.domContainerId+"_link_"+o.FROMID+"_"+o.TOID}).attr("class","link").attr("d",function(o){return a.tools.getSelfLinkPath(o)}).style("marker-end",a.conf.showLinkDirection?"url(#"+a.conf.domContainerId+"_normalTriangle)":null).classed("dashed",function(o){return"dashed"==o.STYLE}),a.selfLinks.exit().remove(),a.nodes=a.conf.domSvg.selectAll("circle.node").data(a.data.nodes,function(o){return a.conf.domContainerId+"_node_"+o.ID}).attr("r",function(o){return o.radius}).style("fill",null).style("fill",function(o){return a.tools.color(o.COLORVALUE)}),a.nodes.enter().append("svg:circle").attr("id",function(o){return a.conf.domContainerId+"_node_"+o.ID}).attr("class","node").attr("r",function(o){return o.radius}).style("fill",function(o){return a.tools.color(o.COLORVALUE)}).on("mouseenter",a.tools.onNodeMouseenter).on("mouseleave",a.tools.onNodeMouseleave).on("click",a.tools.onNodeClick).on("dblclick",a.tools.onNodeDblclick).on("contextmenu",a.tools.onNodeContextmenu),a.nodes.exit().remove(),a.labels=a.conf.domSvg.selectAll("text.label").data(a.data.nodes.filter(function(o){return!o.LABELCIRCULAR&&!a.conf.labelsCircular}),function(o){return a.conf.domContainerId+"_label_"+o.ID}).text(function(o){return o.LABEL}),a.labels.enter().append("svg:text").attr("id",function(o){return a.conf.domContainerId+"_label_"+o.ID}).attr("class","label").text(function(o){return o.LABEL}),a.labels.exit().remove(),a.labelPaths=a.conf.domSvgDefs.selectAll("path.label").data(a.data.nodes.filter(function(o){return o.LABELCIRCULAR||a.conf.labelsCircular}),function(o){return a.conf.domContainerId+"_textPath_"+o.ID}).attr("d",function(o){return a.tools.getLabelPath(o)}),a.labelPaths.enter().append("svg:path").attr("id",function(o){return a.conf.domContainerId+"_textPath_"+o.ID}).attr("class","label").attr("d",function(o){return a.tools.getLabelPath(o)}),a.labelPaths.exit().remove(),a.labelsCircular=a.conf.domSvg.selectAll("text.labelCircular").data(a.data.nodes.filter(function(o){return o.LABELCIRCULAR||a.conf.labelsCircular}),function(o){return a.conf.domContainerId+"_labelCircular_"+o.ID}).each(function(o){d3.select("#"+a.conf.domContainerId+"_pathReference_"+o.ID).text(o.LABEL)}),a.labelsCircular.enter().append("svg:text").attr("id",function(o){return a.conf.domContainerId+"_labelCircular_"+o.ID}).attr("class","labelCircular").append("svg:textPath").attr("id",function(o){return a.conf.domContainerId+"_pathReference_"+o.ID}).attr("xlink:href",function(o){return"#"+a.conf.domContainerId+"_textPath_"+o.ID}).text(function(o){return o.LABEL}),a.labelsCircular.exit().remove(),a.conf.customize||!a.conf.debug&&null===document.querySelector("#apex-dev-toolbar")?a.conf.domSvg.select("#"+a.conf.domContainerId+" svg text.link").remove():null===document.querySelector("#"+a.conf.domContainerId+" svg text.link")&&a.conf.domSvg.append("svg:text").attr("class","link").attr("x",5).attr("y",15).attr("text-anchor","start").text("Customize Me").on("click",function(){a.conf.customize=!0,r()}),a.conf.dragMode?a.nodes.call(a.drag):a.nodes.on("mousedown.drag",null),a.conf.pinMode&&a.conf.dragMode?a.drag.on("dragstart",function(o){d3.select(this).classed("fixed",o.fixed=!0)}):a.drag.on("dragstart",null),a.conf.useDomParentWidth?(a.conf.domContainerWidth=a.tools.getSvgParentInnerWidth(),d3.select(window).on("resize",function(){var o=a.conf.domContainerWidth,n=a.tools.getSvgParentInnerWidth();o!==n&&(a.conf.domContainerWidth=n,r())})):d3.select(window).on("resize",null),a.conf.domSvg.attr("width",a.conf.useDomParentWidth?a.conf.domContainerWidth:a.conf.width).attr("height",a.conf.height),a.force.nodes(a.data.nodes).links(a.data.links).size([a.conf.useDomParentWidth?a.conf.domContainerWidth:a.conf.width,a.conf.height]).friction(a.conf.friction).charge(a.conf.charge).theta(a.conf.theta).gravity(a.conf.gravity).linkDistance(a.conf.linkDistance).linkStrength(a.conf.linkStrength).start(),a.conf.autoRefresh&&a.conf.refreshInterval&&!a.conf.interval?(a.conf.interval=window.setInterval(function(){r.start()},a.conf.refreshInterval),a.tools.log("Auto refresh started with an interval of "+a.conf.refreshInterval+" milliseconds.")):a.conf.autoRefresh===!1&&a.conf.interval&&(clearInterval(a.conf.interval),a.conf.interval=null,a.tools.log("Auto refresh stopped.")),a.tools.triggerApexEvent(document.querySelector("#"+a.conf.domContainerId),"apexafterrefresh")}var a={version:"1.0.5"};return a.conf={},a.data={},a.tools={},a.conf.domContainerId=o||"D3Force"+Math.floor(1e6*Math.random()),a.confUser=n||{},a.conf.apexPluginId=e,a.conf.apexPageItemsToSubmit=t,a.conf.debugPrefix="D3 Force in DOM container #"+a.conf.domContainerId+": ",a.conf.debug=a.conf.apexPluginId&&1==apex.jQuery("#pdebug").length?!0:!1,a.tickCounter,a.startTime,a.confDefaults={showBorder:{type:"bool",val:!0,options:[!0,!1]},showSelfLinks:{type:"bool",val:!0,options:[!0,!1]},showLinkDirection:{type:"bool",val:!0,options:[!0,!1]},showTooltips:{type:"bool",val:!0,options:[!0,!1]},tooltipPosition:{type:"text",val:"node",options:["node","svgTopLeft","svgTopRight"]},colorScheme:{type:"text",val:"color20",options:["color20","color20b","color20c","color10","direct"]},labelsCircular:{type:"bool",val:!1,options:[!0,!1]},dragMode:{type:"bool",val:!0,options:[!0,!1]},pinMode:{type:"bool",val:!1,options:[!0,!1]},nodeEventToStopPinMode:{type:"text",val:"contextmenu",options:["none","dblclick","contextmenu"]},onNodeContextmenuPreventDefault:{type:"bool",val:!1,options:[!0,!1]},nodeEventToOpenLink:{type:"text",val:"dblclick",options:["none","click","dblclick","contextmenu"]},nodeLinkTarget:{type:"text",val:"_blank",options:["none","_blank","nodeID"]},autoRefresh:{type:"bool",val:!1,options:[!0,!1]},refreshInterval:{type:"number",val:5e3,options:[6e4,3e4,15e3,1e4,5e3,2500]},useDomParentWidth:{type:"bool",val:!1,options:[!0,!1]},width:{type:"number",val:500,options:[1200,1150,1100,1050,1e3,950,900,850,800,750,700,650,600,550,500,450,400,350,300]},height:{type:"number",val:500,options:[1200,1150,1100,1050,1e3,950,900,850,800,750,700,650,600,550,500,450,400,350,300]},minNodeRadius:{type:"number",val:6,options:[12,11,10,9,8,7,6,5,4,3,2,1]},maxNodeRadius:{type:"number",val:18,options:[36,34,32,30,28,26,24,22,20,18,16,14,12]},labelDistance:{type:"number",val:12,options:[30,28,26,24,22,20,18,16,14,12,10,8,6,4,2]},selfLinkDistance:{type:"number",val:20,options:[30,28,26,24,22,20,18,16,14,12,10,8]},linkDistance:{type:"number",val:80,options:[120,110,100,90,80,70,60,50,40,30,20]},charge:{type:"number",val:-350,options:[-1e3,-950,-900,-850,-800,-750,-700,-650,-600,-550,-500,-450,-400,-350,-300,-250,-200,-150,-100,-50,0],internal:!0},gravity:{type:"number",val:.1,options:[1,.95,.9,.85,.8,.75,.7,.65,.6,.55,.5,.45,.4,.35,.3,.25,.2,.15,.1,.05,0],internal:!0},linkStrength:{type:"number",val:1,options:[1,.95,.9,.85,.8,.75,.7,.65,.6,.55,.5,.45,.4,.35,.3,.25,.2,.15,.1,.05,0],internal:!0},friction:{type:"number",val:.9,options:[1,.95,.9,.85,.8,.75,.7,.65,.6,.55,.5,.45,.4,.35,.3,.25,.2,.15,.1,.05,0],internal:!0},theta:{type:"number",val:.8,options:[1,.95,.9,.85,.8,.75,.7,.65,.6,.55,.5,.45,.4,.35,.3,.25,.2,.15,.1,.05,0],internal:!0}},a.conf.customize=!1,a.conf.debug=a.confUser.debug||!1,a.conf.showBorder="undefined"!=typeof a.confUser.showBorder?a.confUser.showBorder:a.confDefaults.showBorder.val,a.conf.showSelfLinks="undefined"!=typeof a.confUser.showSelfLinks?a.confUser.showSelfLinks:a.confDefaults.showSelfLinks.val,a.conf.showLinkDirection="undefined"!=typeof a.confUser.showLinkDirection?a.confUser.showLinkDirection:a.confDefaults.showLinkDirection.val,a.conf.showTooltips="undefined"!=typeof a.confUser.showTooltips?a.confUser.showTooltips:a.confDefaults.showTooltips.val,a.conf.tooltipPosition=a.confUser.tooltipPosition||a.confDefaults.tooltipPosition.val,a.conf.colorScheme=a.confUser.colorScheme||a.confDefaults.colorScheme.val,a.conf.labelsCircular="undefined"!=typeof a.confUser.labelsCircular?a.confUser.labelsCircular:a.confDefaults.labelsCircular.val,a.conf.dragMode="undefined"!=typeof a.confUser.dragMode?a.confUser.dragMode:a.confDefaults.dragMode.val,a.conf.pinMode="undefined"!=typeof a.confUser.pinMode?a.confUser.pinMode:a.confDefaults.pinMode.val,a.conf.nodeEventToStopPinMode=a.confUser.nodeEventToStopPinMode||a.confDefaults.nodeEventToStopPinMode.val,a.conf.onNodeContextmenuPreventDefault="undefined"!=typeof a.confUser.onNodeContextmenuPreventDefault?a.confUser.onNodeContextmenuPreventDefault:a.confDefaults.onNodeContextmenuPreventDefault.val,a.conf.nodeEventToOpenLink=a.confUser.nodeEventToOpenLink||a.confDefaults.nodeEventToOpenLink.val,a.conf.nodeLinkTarget=a.confUser.nodeLinkTarget||a.confDefaults.nodeLinkTarget.val,a.conf.autoRefresh="undefined"!=typeof a.confUser.autoRefresh?a.confUser.autoRefresh:a.confDefaults.autoRefresh.val,a.conf.refreshInterval=a.confUser.refreshInterval||a.confDefaults.refreshInterval.val,a.conf.useDomParentWidth="undefined"!=typeof a.confUser.useDomParentWidth?a.confUser.useDomParentWidth:a.confDefaults.useDomParentWidth.val,a.conf.width=a.confUser.width||a.confDefaults.width.val,a.conf.height=a.confUser.height||a.confDefaults.height.val,a.conf.minNodeRadius=a.confUser.minNodeRadius||a.confDefaults.minNodeRadius.val,a.conf.maxNodeRadius=a.confUser.maxNodeRadius||a.confDefaults.maxNodeRadius.val,a.conf.labelDistance=a.confUser.labelDistance||a.confDefaults.labelDistance.val,a.conf.selfLinkDistance=a.confUser.selfLinkDistance||a.confDefaults.selfLinkDistance.val,a.conf.linkDistance=a.confUser.linkDistance||a.confDefaults.linkDistance.val,a.conf.chargeDistance=a.confUser.chargeDistance||null,a.conf.charge=a.confUser.charge||a.confDefaults.charge.val,a.conf.gravity=a.confUser.gravity||a.confDefaults.gravity.val,a.conf.linkStrength=a.confUser.linkStrength||a.confDefaults.linkStrength.val,a.conf.friction=a.confUser.friction||a.confDefaults.friction.val,a.conf.theta=a.confUser.theta||a.confDefaults.theta.val,a.conf.onNodeMouseenterFunction=a.confUser.onNodeMouseenterFunction||null,a.conf.onNodeMouseleaveFunction=a.confUser.onNodeMouseleaveFunction||null,a.conf.onNodeClickFunction=a.confUser.onNodeClickFunction||null,a.conf.onNodeDblclickFunction=a.confUser.onNodeDblclickFunction||null,a.conf.onNodeContextmenuFunction=a.confUser.onNodeContextmenuFunction||null,a.conf.currentTabPosition=null,a.conf.sampleData=!1,a.data.sampleData='<data><nodes ID="7839" LABEL="KING is THE KING, you know?" COLORVALUE="10" SIZEVALUE="5000" LABELCIRCULAR="true" LINK="http://apex.oracle.com/" INFOSTRING="This visualization is based on the well known emp table." /><nodes ID="7698" LABEL="BLAKE" COLORVALUE="30" SIZEVALUE="2850"/><nodes ID="7782" LABEL="CLARK" COLORVALUE="10" SIZEVALUE="2450"/><nodes ID="7566" LABEL="JONES" COLORVALUE="20" SIZEVALUE="2975"/><nodes ID="7788" LABEL="SCOTT" COLORVALUE="20" SIZEVALUE="3000"/><nodes ID="7902" LABEL="FORD" COLORVALUE="20" SIZEVALUE="3000"/><nodes ID="7369" LABEL="SMITH" COLORVALUE="20" SIZEVALUE="800"/><nodes ID="7499" LABEL="ALLEN" COLORVALUE="30" SIZEVALUE="1600"/><nodes ID="7521" LABEL="WARD" COLORVALUE="30" SIZEVALUE="1250"/><nodes ID="7654" LABEL="MARTIN" COLORVALUE="30" SIZEVALUE="1250"/><nodes ID="7844" LABEL="TURNER" COLORVALUE="30" SIZEVALUE="1500"/><nodes ID="7876" LABEL="ADAMS" COLORVALUE="20" SIZEVALUE="1100"/><nodes ID="7900" LABEL="JAMES" COLORVALUE="30" SIZEVALUE="950"/><nodes ID="7934" LABEL="MILLER" COLORVALUE="10" SIZEVALUE="1300"/><nodes ID="8888" LABEL="Who am I?" COLORVALUE="green" SIZEVALUE="2000" INFOSTRING="This is a good question. Think about it." /><nodes ID="9999" LABEL="Where I am?" COLORVALUE="#f00" SIZEVALUE="1000" INFOSTRING="This is a good question. What do you think?" /><links FROMID="7839" TOID="7839" STYLE="dashed"/><links FROMID="7698" TOID="7839" STYLE="solid"/><links FROMID="7782" TOID="7839" STYLE="solid"/><links FROMID="7566" TOID="7839" STYLE="solid"/><links FROMID="7788" TOID="7566" STYLE="solid"/><links FROMID="7902" TOID="7566" STYLE="solid"/><links FROMID="7369" TOID="7902" STYLE="solid"/><links FROMID="7499" TOID="7698" STYLE="solid"/><links FROMID="7521" TOID="7698" STYLE="solid"/><links FROMID="7654" TOID="7698" STYLE="solid"/><links FROMID="7844" TOID="7698" STYLE="solid"/><links FROMID="7876" TOID="7788" STYLE="solid"/><links FROMID="7900" TOID="7698" STYLE="solid"/><links FROMID="7934" TOID="7782" STYLE="solid"/></data>',null===document.querySelector("#"+a.conf.domContainerId)?a.conf.domContainer=d3.select("body").append("div").attr("id",a.conf.domContainerId):(a.conf.domContainer=d3.select("#"+a.conf.domContainerId),d3.selectAll("#"+a.conf.domContainerId+"_tooltip, #"+a.conf.domContainerId+"_customizing").remove()),null===document.querySelector("#"+a.conf.domContainerId+" svg")?a.conf.domSvg=a.conf.domContainer.append("svg"):(a.conf.domSvg=d3.select("#"+a.conf.domContainerId+" svg"),d3.select("#"+a.conf.domContainerId+" svg defs").remove()),a.conf.domSvg.attr("id",a.conf.domContainerId+"_svg").attr("class","net_gobrechts_d3_force").classed("border",a.conf.showBorder).attr("width",a.conf.width).attr("height",a.conf.height),a.conf.domSvgDefs=a.conf.domSvg.append("defs"),a.conf.domSvgDefs.append("svg:marker").attr("id",a.conf.domContainerId+"_highlightedTriangle").attr("class","highlighted").attr("viewBox","0 0 10 10").attr("refX",10).attr("refY",5).attr("markerWidth",5).attr("markerHeight",5).attr("orient","auto").attr("markerUnits","strokeWidth").append("svg:path").attr("d","M0,0 L10,5 L0,10"),a.conf.domSvgDefs.append("svg:marker").attr("id",a.conf.domContainerId+"_normalTriangle").attr("class","normal").attr("viewBox","0 0 10 10").attr("refX",10).attr("refY",5).attr("markerWidth",5).attr("markerHeight",5).attr("orient","auto").attr("markerUnits","strokeWidth").append("svg:path").attr("d","M0,0 L10,5 L0,10"),a.conf.domTooltip=a.conf.domContainer.append("div").attr("id",a.conf.domContainerId+"_tooltip").attr("class","net_gobrechts_d3_force_tooltip").style("top","0px").style("left","0px"),a.tools.log=function(o,n){a.conf.debug&&console.log(n?o:a.conf.debugPrefix+o),a.conf.customize&&a.conf.domCustomizeLog.text(o+"\n"+a.conf.domCustomizeLog.text())},a.tools.logError=function(o){console.log(a.conf.debugPrefix+"ERROR: "+o),a.conf.customize&&a.conf.domCustomizeLog.text("ERROR: "+o+"\n"+a.conf.domCustomizeLog.text())},a.tools.triggerApexEvent=function(o,n,e){a.conf.apexPluginId&&apex.event.trigger(o,n,e)},a.tools.neighboring=function(o,n){return a.data.neighbors.indexOf(o.ID+":"+n.ID)>-1||a.data.neighbors.indexOf(n.ID+":"+o.ID)>-1},a.tools.adjustSourceX=function(o){return o.source.x+Math.cos(a.tools.calcAngle(o))*o.source.radius},a.tools.adjustSourceY=function(o){return o.source.y+Math.sin(a.tools.calcAngle(o))*o.source.radius},a.tools.adjustTargetX=function(o){return o.target.x-Math.cos(a.tools.calcAngle(o))*o.target.radius},a.tools.adjustTargetY=function(o){return o.target.y-Math.sin(a.tools.calcAngle(o))*o.target.radius},a.tools.calcAngle=function(o){return Math.atan2(o.target.y-o.source.y,o.target.x-o.source.x)},a.tools.getSelfLinkPath=function(o){var n=o.source.radius,e=o.source.radius+a.conf.selfLinkDistance,t=0,r=0,i={source:{x:0,y:0,radius:n},target:{x:t+e/2,y:r+e,radius:n}},s={source:{x:t-e/2,y:r+e,radius:n},target:{x:t,y:r,radius:n}},c="M"+a.tools.adjustSourceX(i)+","+a.tools.adjustSourceY(i);return c+=" L"+(t+e/2)+","+(r+e),c+=" A"+e+","+e+" 0 0,1 "+(t-e/2)+","+(r+e),c+=" L"+a.tools.adjustTargetX(s)+","+a.tools.adjustTargetY(s)},a.tools.getLabelPath=function(o){var n=o.radius+a.conf.labelDistance,e=0,t=0,r="M"+(e-n)+","+t;return r+=" a"+n+","+n+" 0 0,1 "+2*n+",0",r+=" a"+n+","+n+" 0 0,1 -"+2*n+",0"},a.tools.openLink=function(o){var n;"none"==a.conf.nodeLinkTarget?window.location.assign(o.LINK):"nodeID"==a.conf.nodeLinkTarget?(n=window.open(o.LINK,o.ID),n.focus()):(n=window.open(o.LINK,a.conf.nodeLinkTarget),n.focus())},a.tools.onNodeMouseenter=function(o){var n;a.nodes.classed("highlighted",function(n){return a.tools.neighboring(n,o)}),a.links.classed("highlighted",function(n){return n.source.ID==o.ID||n.target.ID==o.ID}).style("marker-end",function(n){return a.conf.showLinkDirection?"url(#"+a.conf.domContainerId+"_"+(n.source.ID==o.ID||n.target.ID==o.ID?"highlighted":"normal")+"Triangle)":null}),a.selfLinks.classed("highlighted",function(n){return n.FROMID==o.ID}).style("marker-end",function(n){return a.conf.showLinkDirection?"url(#"+a.conf.domContainerId+"_"+(n.source.ID==o.ID||n.target.ID==o.ID?"highlighted":"normal")+"Triangle)":null}),d3.select(this).classed("highlighted",!0),a.tools.log("Event mouseenter triggered."),a.tools.triggerApexEvent(this,"net_gobrechts_d3_force_mouseenter",o),"function"==typeof a.conf.onNodeMouseenterFunction&&a.conf.onNodeMouseenterFunction.call(this,d3.event,o),a.conf.showTooltips&&o.INFOSTRING&&(a.conf.domTooltip.html(o.INFOSTRING).style("display","block"),"svgTopLeft"===a.conf.tooltipPosition?(n=a.tools.getOffsetRect(document.querySelector("#"+a.conf.domContainerId+" svg")),a.conf.domTooltip.style("top",n.top+(a.conf.domSvg.style("border-width")?parseInt(a.conf.domSvg.style("border-width")):1)+"px").style("left",n.left+(a.conf.domSvg.style("border-width")?parseInt(a.conf.domSvg.style("border-width")):1)+"px")):"svgTopRight"===a.conf.tooltipPosition?(n=a.tools.getOffsetRect(document.querySelector("#"+a.conf.domContainerId+" svg")),a.conf.domTooltip.style("top",n.top+parseInt(a.conf.domSvg.style("border-width")?parseInt(a.conf.domSvg.style("border-width")):1)+"px").style("left",n.left+parseInt(a.conf.domSvg.style("width"))+parseInt(a.conf.domSvg.style("border-width")?parseInt(a.conf.domSvg.style("border-width")):1)-parseInt(a.conf.domTooltip.style("width"))-2*parseInt(a.conf.domTooltip.style("border-width")?parseInt(a.conf.domTooltip.style("border-width")):0)-parseInt(a.conf.domTooltip.style("padding-left"))-parseInt(a.conf.domTooltip.style("padding-right"))+"px")):a.conf.domTooltip.style("left",d3.event.pageX+"px").style("top",d3.event.pageY+"px"))},a.tools.onNodeMouseleave=function(o){a.nodes.classed("highlighted",!1),a.links.classed("highlighted",!1).style("marker-end",a.conf.showLinkDirection?"url(#"+a.conf.domContainerId+"_normalTriangle)":null),a.selfLinks.classed("highlighted",!1).style("marker-end",a.conf.showLinkDirection?"url(#"+a.conf.domContainerId+"_normalTriangle)":null),a.labels.classed("highlighted",!1),a.tools.log("Event mouseleave triggered."),a.tools.triggerApexEvent(this,"net_gobrechts_d3_force_mouseleave",o),"function"==typeof a.conf.onNodeMouseleaveFunction&&a.conf.onNodeMouseleaveFunction.call(this,d3.event,o),a.conf.showTooltips&&a.conf.domTooltip.style("display","none")},a.tools.onNodeClick=function(o){o.LINK&&"click"==a.conf.nodeEventToOpenLink&&a.tools.openLink(o),a.conf.pinMode&&"click"==a.conf.nodeEventToStopPinMode&&d3.select(this).classed("fixed",o.fixed=!1),a.tools.log("Event click triggered."),a.tools.triggerApexEvent(this,"net_gobrechts_d3_force_click",o),"function"==typeof a.conf.onNodeClickFunction&&a.conf.onNodeClickFunction.call(this,d3.event,o)},a.tools.onNodeDblclick=function(o){o.LINK&&"dblclick"==a.conf.nodeEventToOpenLink&&a.tools.openLink(o),a.conf.pinMode&&"dblclick"==a.conf.nodeEventToStopPinMode&&d3.select(this).classed("fixed",o.fixed=!1),a.tools.log("Event dblclick triggered."),a.tools.triggerApexEvent(this,"net_gobrechts_d3_force_dblclick",o),"function"==typeof a.conf.onNodeDblclickFunction&&a.conf.onNodeDblclickFunction.call(this,d3.event,o)},a.tools.onNodeContextmenu=function(o){a.conf.onNodeContextmenuPreventDefault&&d3.event.preventDefault(),o.LINK&&"contextmenu"==a.conf.nodeEventToOpenLink&&a.tools.openLink(o),a.conf.pinMode&&"contextmenu"==a.conf.nodeEventToStopPinMode&&d3.select(this).classed("fixed",o.fixed=!1),a.tools.log("Event contextmenu triggered."),a.tools.triggerApexEvent(this,"net_gobrechts_d3_force_contextmenu",o),"function"==typeof a.conf.onNodeContextmenuFunction&&a.conf.onNodeContextmenuFunction.call(this,d3.event,o)},a.tools.x2js=new X2JS({attributePrefix:"none"}),a.tools.getSvgParentInnerWidth=function(){var o=d3.select(a.conf.domSvg.node().parentNode);return parseInt(o.style("width"))-parseInt(o.style("padding-left"))-parseInt(o.style("padding-right"))-2*(a.conf.domSvg.style("border-width")?parseInt(a.conf.domSvg.style("border-width")):1)},a.tools.getOffsetRect=function(o){var n=o.getBoundingClientRect(),e=document.body,t=document.documentElement,r=window.pageYOffset||t.scrollTop||e.scrollTop,a=window.pageXOffset||t.scrollLeft||e.scrollLeft,i=t.clientTop||e.clientTop||0,s=t.clientLeft||e.clientLeft||0,c=n.top+r-i,l=n.left+a-s;return{top:Math.round(c),left:Math.round(l)}},a.tools.customizeDrag=d3.behavior.drag().on("dragstart",function(){var o=d3.mouse(document.body);a.conf.domCustomizePosition=a.tools.getOffsetRect(document.querySelector("#"+a.conf.domContainerId+"_customizing")),a.conf.domCustomizePosition.mouseLeft=o[0]-a.conf.domCustomizePosition.left,a.conf.domCustomizePosition.mouseTop=o[1]-a.conf.domCustomizePosition.top}).on("drag",function(){var o=d3.mouse(document.body);a.conf.domCustomize.style("left",Math.max(0,o[0]-a.conf.domCustomizePosition.mouseLeft)+"px").style("top",Math.max(0,o[1]-a.conf.domCustomizePosition.mouseTop)+"px")}).on("dragend",function(){a.conf.domCustomizePosition=a.tools.getOffsetRect(a.conf.domCustomize.node())}),a.tools.customizeChart=function(){var o,n,e,t,i,s,c,l=0;a.conf.domCustomizePosition||(a.conf.domCustomizePosition=a.tools.getOffsetRect(a.conf.domSvg.node()),a.conf.domCustomizePosition.left=a.conf.domCustomizePosition.left+a.conf.width+8,a.conf.domCustomizePosition.top=a.conf.domCustomizePosition.top),null!==document.querySelector("#"+a.conf.domContainerId+"_customizing")&&a.conf.domCustomize.remove(),a.conf.domCustomize=a.conf.domContainer.append("div").attr("id",a.conf.domContainerId+"_customizing").attr("class","net_gobrechts_d3_force_customize").style("left",a.conf.domCustomizePosition.left+"px").style("top",a.conf.domCustomizePosition.top+"px"),a.conf.domCustomize.append("span").attr("class","drag").call(a.tools.customizeDrag).append("span").attr("class","title").text('Customize "'+a.conf.domContainerId+'"'),a.conf.domCustomize.append("a").attr("class","close focus").attr("tabindex",1).text("Close").on("click",function(){a.conf.customize=!1,r()}).on("keydown",function(){13==d3.event.keyCode&&(a.conf.customize=!1,r())}),o=a.conf.domCustomize.append("table");for(var d in a.confDefaults)a.confDefaults.hasOwnProperty(d)&&(l+=1,n=o.append("tr"),n.append("td").attr("class","label").html('<a href="https://github.com/ogobrecht/d3-force-apex-plugin/wiki/API-Reference#'+d.toLowerCase()+'" target="github_d3_force" tabindex="'+l+'100">'+d+"</a>"),e=n.append("td"),t=e.append("select").attr("id",a.conf.domContainerId+"_"+d).attr("name",d).attr("value",a.conf[d]).attr("tabindex",l+1).classed("warning",a.confDefaults[d].internal).on("change",function(){a.conf.currentTabPosition=this.id,"text"==a.confDefaults[this.name].type?a.conf[this.name]=this.options[this.selectedIndex].value:"number"==a.confDefaults[this.name].type?a.conf[this.name]=parseFloat(this.options[this.selectedIndex].value):"bool"==a.confDefaults[this.name].type&&(a.conf[this.name]="true"==this.options[this.selectedIndex].value?!0:!1),a.tools.createCustomizingConfObject(),r()}),c=!1,a.confDefaults[d].options.forEach(function(o){s=o,t.append("option").attr("value",o).attr("selected",function(){return"text"==a.confDefaults[d].type||"bool"==a.confDefaults[d].type?s==a.conf[d]?(c=!0,"selected"):null:"number"==a.confDefaults[d].type?parseFloat(s)==a.conf[d]?(c=!0,"selected"):null:void 0}).text(o)}),c||(t.append("option").attr("value",a.conf[d]).attr("selected","selected").text(a.conf[d]),a.confDefaults[d].options.push(a.conf[d])),1==l&&(i=n.append("td").style("vertical-align","top").style("padding-left","5px")));i.attr("rowspan",l).html('Your Configuration Object<br><textarea id="'+a.conf.domContainerId+'_conf_object" tabindex="'+(l+2)+'" readonly></textarea><br><br>Current Positions<br><textarea id="'+a.conf.domContainerId+'_positions" tabindex="'+(l+3)+'" readonly>Force started - wait for end event to show positions...</textarea><br><br>Debug Log (descending)<br><textarea id="'+a.conf.domContainerId+'_log" tabindex="'+(l+4)+'" readonly></textarea><br><br>Copyrights<br><br><a href="https://github.com/ogobrecht/d3-force-apex-plugin" target="github_d3_force" tabindex="'+(l+5)+'">D3 Force APEX Plugin</a> ('+a.version+')<br>Ottmar Gobrecht<br><br><a href="http://d3js.org" target="d3js_org" tabindex="'+(l+6)+'">D3.js</a> ('+d3.version+')<br>Mike Bostock<br><br><a href="https://code.google.com/p/x2js/" target="code_google_com" tabindex="'+(l+7)+'">X2JS</a> ('+a.tools.x2js.getVersion()+" modified)<br>Abdulla Abdurakhmanov<br><br>"),a.conf.domCustomizeConfObject=d3.select("#"+a.conf.domContainerId+"_conf_object"),a.conf.domCustomizePositions=d3.select("#"+a.conf.domContainerId+"_positions"),a.conf.domCustomizeLog=d3.select("#"+a.conf.domContainerId+"_log"),a.tools.createCustomizingConfObject(),a.conf.currentTabPosition?document.getElementById(a.conf.currentTabPosition).focus():document.querySelector("#"+a.conf.domContainerId+"_customizing select").focus()},a.tools.createCustomizingConfObject=function(){var o="{\n";for(var n in a.confDefaults)a.confDefaults.hasOwnProperty(n)&&(o+="range"==a.confDefaults[n].type||"number"==a.confDefaults[n].type||"bool"==a.confDefaults[n].type?'"'+n+'":'+a.conf[n]+",\n":'"'+n+'":"'+a.conf[n]+'",\n');o=o.substr(0,o.length-2)+"\n}",a.conf.domCustomizeConfObject.text(o)},a.conf.userAgent=navigator.userAgent,a.conf.userAgent_IE_9_to_11=!1,(-1!==navigator.appVersion.indexOf("MSIE 9")||-1!==navigator.appVersion.indexOf("MSIE 10")||-1!==a.conf.userAgent.indexOf("Trident")&&-1!==a.conf.userAgent.indexOf("rv:11"))&&(a.conf.userAgent_IE_9_to_11=!0,a.tools.logError("Houston, we have a problem - user agent is IE 9, 10 or 11 - we have to provide a fix for markers: http://stackoverflow.com/questions/15588478/internet-explorer-10-not-showing-svg-path-d3-js-graph")),a.force=d3.layout.force().on("start",function(){a.tools.log("Force started."),a.conf.customize&&a.conf.domCustomizePositions.text("Force started - wait for end event to show positions..."),a.tickCounter=0,a.startTime=(new Date).getTime()}).on("tick",function(){a.conf.userAgent_IE_9_to_11&&a.conf.showLinkDirection&&(a.links.each(function(){this.parentNode.insertBefore(this,this)}),a.selfLinks.each(function(){this.parentNode.insertBefore(this,this)})),a.selfLinks.attr("transform",function(o){return"translate("+o.source.x+","+o.source.y+")"}),a.links.attr("x1",function(o){return a.tools.adjustSourceX(o)}).attr("y1",function(o){return a.tools.adjustSourceY(o)}).attr("x2",function(o){return a.tools.adjustTargetX(o)
}).attr("y2",function(o){return a.tools.adjustTargetY(o)}),a.labels.attr("x",function(o){return o.x}).attr("y",function(o){return o.y-o.radius-a.conf.labelDistance}),a.labelPaths.attr("transform",function(o){return"translate("+o.x+","+o.y+")"}),a.nodes.attr("cx",function(o){return o.x}).attr("cy",function(o){return o.y}),a.tickCounter+=1}).on("end",function(){var o=(new Date).getTime()-a.startTime,n=(o/1e3).toFixed(1),e=Math.round(a.tickCounter/(o/1e3)),t=Math.round(o/a.tickCounter);a.conf.customize&&a.conf.domCustomizePositions.text(r.positions()),a.tools.log("Force ended."),a.tools.log(n+" seconds, "+a.tickCounter+" ticks to cool down ("+e+" ticks/s, "+t+" ms/tick).")}),a.drag=a.force.drag(),r.start=function(o){var n;return o?r(o):a.conf.apexPluginId?apex.server.plugin(a.conf.apexPluginId,{p_debug:$v("pdebug"),pageItems:a.conf.apexPageItemsToSubmit.split(",")},{success:function(o){n=o.trim().substr(0,1),"<"==n||"{"==n?r(o):"no_query_defined"==o.trim().substr(0,16)?(r(),a.tools.logError("No query defined.")):"query_returned_no_data"==o.trim().substr(0,22)?(r('{"data":{"nodes":[{"ID":"1","LABEL":"ERROR: No data.","COLORVALUE":"1","SIZEVALUE":"1"}],"links":[]}}'),a.tools.logError("Query returned no data.")):(r('{"data":{"nodes":[{"ID":"1","LABEL":"ERROR: '+o+'.","COLORVALUE":"1","SIZEVALUE":"1"}],"links":[]}}'),a.tools.logError(o))},error:function(o,n,e){r('{"data":{"nodes":[{"ID":"1","LABEL":"AJAX call terminated with errors.","COLORVALUE":"1","SIZEVALUE":"1"}],"links":[]}}'),a.tools.logError("AJAX call terminated with errors: "+e+".")},dataType:"text"}):r(),r},r.showBorder=function(o){return arguments.length?(a.conf.showBorder=o,r):a.conf.showBorder},r.showSelfLinks=function(o){return arguments.length?(a.conf.showSelfLinks=o,r):a.conf.showSelfLinks},r.showLinkDirection=function(o){return arguments.length?(a.conf.showLinkDirection=o,r):a.conf.showLinkDirection},r.showTooltips=function(o){return arguments.length?(a.conf.showTooltips=o,r):a.conf.showTooltips},r.tooltipPosition=function(o){return arguments.length?(a.conf.tooltipPosition=o,r):a.conf.tooltipPosition},r.colorScheme=function(o){return arguments.length?(a.conf.colorScheme=o,r):a.conf.colorScheme},r.labelsCircular=function(o){return arguments.length?(a.conf.labelsCircular=o,r):a.conf.labelsCircular},r.dragMode=function(o){return arguments.length?(a.conf.dragMode=o,r):a.conf.dragMode},r.pinMode=function(o){return arguments.length?(a.conf.pinMode=o,r):a.conf.pinMode},r.nodeEventToStopPinMode=function(o){return arguments.length?(a.conf.nodeEventToStopPinMode=o,r):a.conf.nodeEventToStopPinMode},r.onNodeContextmenuPreventDefault=function(o){return arguments.length?(a.conf.onNodeContextmenuPreventDefault=o,r):a.conf.onNodeContextmenuPreventDefault},r.nodeEventToOpenLink=function(o){return arguments.length?(a.conf.nodeEventToOpenLink=o,r):a.conf.nodeEventToOpenLink},r.nodeLinkTarget=function(o){return arguments.length?(a.conf.nodeLinkTarget=o,r):a.conf.nodeLinkTarget},r.autoRefresh=function(o){return arguments.length?(a.conf.autoRefresh=o,r):a.conf.autoRefresh},r.refreshInterval=function(o){return arguments.length?(a.conf.refreshInterval=o,r):a.conf.refreshInterval},r.useDomParentWidth=function(o){return arguments.length?(a.conf.useDomParentWidth=o,r):a.conf.useDomParentWidth},r.width=function(o){return arguments.length?(a.conf.width=o,r):a.conf.width},r.height=function(o){return arguments.length?(a.conf.height=o,r):a.conf.height},r.minNodeRadius=function(o){return arguments.length?(a.conf.minNodeRadius=o,r):a.conf.minNodeRadius},r.maxNodeRadius=function(o){return arguments.length?(a.conf.maxNodeRadius=o,r):a.conf.maxNodeRadius},r.labelDistance=function(o){return arguments.length?(a.conf.labelDistance=o,r):a.conf.labelDistance},r.selfLinkDistance=function(o){return arguments.length?(a.conf.selfLinkDistance=o,r):a.conf.selfLinkDistance},r.linkDistance=function(o){return arguments.length?(a.conf.linkDistance=o,r):a.conf.linkDistance},r.charge=function(o){return arguments.length?(a.conf.charge=o,r):a.conf.charge},r.gravity=function(o){return arguments.length?(a.conf.gravity=o,r):a.conf.gravity},r.chargeDistance=function(o){return arguments.length?(a.conf.chargeDistance=o,r):a.conf.chargeDistance},r.linkStrength=function(o){return arguments.length?(a.conf.linkStrength=o,r):a.conf.linkStrength},r.friction=function(o){return arguments.length?(a.conf.friction=o,r):a.conf.friction},r.theta=function(o){return arguments.length?(a.conf.theta=o,r):a.conf.theta},r.positions=function(o){if(arguments.length)return a.conf.positions=o,r;var n="[\n";return a.data.nodes.forEach(function(o){n+='{"ID":"'+o.ID+'","x":'+Math.round(o.x)+',"y":'+Math.round(o.y)+',"fixed":'+(o.fixed?1:0)+"},\n"}),n.substr(0,n.length-2)+"\n]"},r.onNodeMouseenterFunction=function(o){return arguments.length?(a.conf.onNodeMouseenterFunction=o,r):a.conf.onNodeMouseenterFunction},r.onNodeMouseleaveFunction=function(o){return arguments.length?(a.conf.onNodeMouseleaveFunction=o,r):a.conf.onNodeMouseleaveFunction},r.onNodeClickFunction=function(o){return arguments.length?(a.conf.onNodeClickFunction=o,r):a.conf.onNodeClickFunction},r.onNodeDblclickFunction=function(o){return arguments.length?(a.conf.onNodeDblclickFunction=o,r):a.conf.onNodeDblclickFunction},r.onNodeContextmenuFunction=function(o){return arguments.length?(a.conf.onNodeContextmenuFunction=o,r):a.conf.onNodeContextmenuFunction},r.sampleData=function(o){return arguments.length?(a.data.sampleData=o,r):a.data.sampleData},r.customize=function(o){return arguments.length?(a.conf.customize=o,a.conf.customize&&(a.conf.debug=!0),r):a.conf.customize},r.debug=function(o){return arguments.length?(a.conf.debug=o,r):a.conf.debug},r.userAgent=function(){return a.conf.userAgent},r.inspect=function(){return a},r.version=function(){return a.version},a.conf.apexPluginId&&apex.jQuery("#"+a.conf.domContainerId).bind("apexrefresh",function(){r.start()}),r}