function net_gobrechts_d3_force(o,t,e,n){"use strict";function s(o){var t;if(r.status.graphStarted=!0,r.tools.triggerApexEvent(document.querySelector("#"+r.dom.containerId),"apexbeforerefresh"),o||r.status.graphReady?o&&(r.conf.sampleData=!1):(r.tools.logError("Houston, we have a problem - we have to provide sample data."),r.conf.sampleData=!0,o=r.data.sampleData),o){if(r.status.graphReady&&(r.status.graphOldPositions=s.positions()),o.constructor===Object)r.data.dataStringConverted=o,r.conf.debug&&(r.tools.log("Data object:"),r.tools.log(r.data.dataStringConverted,!0));else if(o.constructor===String){if("<"==o.trim().substr(0,1))try{r.data.dataStringConverted=r.tools.x2js.xml_str2json(o),null===r.data.dataStringConverted&&(t="Unable to convert XML string.",r.tools.logError(t),r.data.dataStringConverted={data:{nodes:[{ID:"1",LABEL:"ERROR: "+t,COLORVALUE:"1",SIZEVALUE:"1"}],links:[]}})}catch(e){t="Unable to convert XML string: "+e.message+".",r.tools.logError(t),r.data.dataStringConverted={data:{nodes:[{ID:"1",LABEL:"ERROR: "+t,COLORVALUE:"1",SIZEVALUE:"1"}],links:[]}}}else if("{"==o.trim().substr(0,1))try{r.data.dataStringConverted=JSON.parse(o)}catch(e){t="Unable to parse JSON string: "+e.message+".",r.tools.logError(t),r.data.dataStringConverted={data:{nodes:[{ID:"1",LABEL:"ERROR: "+t,COLORVALUE:"1",SIZEVALUE:"1"}],links:[]}}}else t='Your data string is not starting with "<" or "{" - parsing not possible.',r.tools.logError(t),r.data.dataStringConverted={data:{nodes:[{ID:"1",LABEL:"ERROR: "+t,COLORVALUE:"1",SIZEVALUE:"1"}],links:[]}};r.conf.debug&&(r.tools.log("Data string:"),r.tools.log(o,!0),r.tools.log("Converted data object:"),r.tools.log(r.data.dataStringConverted,!0))}else t="Unable to parse your data - input data can be a XML string, JSON string or JavaScript object.",r.tools.logError(t),r.data.dataStringConverted={data:{nodes:[{ID:"1",LABEL:"ERROR: "+t,COLORVALUE:"1",SIZEVALUE:"1"}],links:[]}};null!==r.data.dataStringConverted?r.data.dataStringConverted.hasOwnProperty("data")&&null!==r.data.dataStringConverted.data?(r.data.dataStringConverted.data.hasOwnProperty("nodes")&&null!==r.data.dataStringConverted.data.nodes?(r.data.nodes=r.data.dataStringConverted.data.nodes,0==r.data.nodes.length&&(t="Your data contains an empty nodes array.",r.tools.logError(t),r.data.nodes=[{ID:"1",LABEL:"ERROR: "+t,COLORVALUE:"1",SIZEVALUE:"1"}])):(t="Your data contains no nodes.",r.tools.logError(t),r.data.nodes=[{ID:"1",LABEL:"ERROR: "+t,COLORVALUE:"1",SIZEVALUE:"1"}]),r.data.links=r.data.dataStringConverted.data.hasOwnProperty("links")&&null!==r.data.dataStringConverted.data.links?r.data.dataStringConverted.data.links:[]):(t="Missing root element named data.",r.tools.logError(t),r.data={nodes:[{ID:"1",LABEL:"ERROR: "+t,COLORVALUE:"1",SIZEVALUE:"1"}],links:[]}):(t="Unable to parse your data - please consult the API reference for possible data formats.",r.tools.logError(t),r.data={nodes:[{ID:"1",LABEL:"ERROR: "+t,COLORVALUE:"1",SIZEVALUE:"1"}],links:[]}),r.tools.setRadiusFunction(),r.data.id_lookup=[],r.data.nodes.forEach(function(o){o.SIZEVALUE=parseFloat(o.SIZEVALUE),o.LABELCIRCULAR=r.tools.parseBool(o.LABELCIRCULAR),o.fixed&&(o.fixed=r.tools.parseBool(o.fixed)),o.x&&(o.x=parseFloat(o.x)),o.y&&(o.y=parseFloat(o.y)),r.data.id_lookup[o.ID]=o}),r.data.links.forEach(function(o){o.source=r.data.id_lookup[o.FROMID],o.target=r.data.id_lookup[o.TOID]}),r.data.links=r.data.links.filter(function(o){return"undefined"!=typeof o.source&&"undefined"!=typeof o.target}),r.data.neighbors=r.data.links.map(function(o){return o.FROMID+":"+o.TOID}),r.conf.positions?r.conf.positions.constructor===Array?r.conf.positions.forEach(function(o){void 0!==r.data.id_lookup[o.ID]&&(r.data.id_lookup[o.ID].fixed||(r.data.id_lookup[o.ID].fixed=o.fixed),r.data.id_lookup[o.ID].x||(r.data.id_lookup[o.ID].x=r.data.id_lookup[o.ID].px=o.x),r.data.id_lookup[o.ID].y||(r.data.id_lookup[o.ID].y=r.data.id_lookup[o.ID].py=o.y))}):r.tools.logError("Unable to set node positions: positions method parameter must be an array of node positions"):r.status.graphOldPositions&&r.status.graphOldPositions.forEach(function(o){void 0!==r.data.id_lookup[o.ID]&&(r.data.id_lookup[o.ID].fixed||(r.data.id_lookup[o.ID].fixed=o.fixed),r.data.id_lookup[o.ID].x||(r.data.id_lookup[o.ID].x=r.data.id_lookup[o.ID].px=o.x),r.data.id_lookup[o.ID].y||(r.data.id_lookup[o.ID].y=r.data.id_lookup[o.ID].py=o.y))}),r.conf.positions=null,r.status.graphOldPositions=null}r.tools.setRadiusFunction(),r.data.nodes.forEach(function(o){o.radius=r.tools.radius(o.SIZEVALUE)}),s.showBorder(r.conf.showBorder),s.useDomParentWidth(r.conf.useDomParentWidth),r.links=r.dom.svg.selectAll("line.link").data(r.data.links.filter(function(o){return o.FROMID!=o.TOID}),function(o){return o.FROMID+"_"+o.TOID}),r.links.enter().append("svg:line").attr("class","link"),r.links.exit().remove(),r.links.style("marker-end",r.conf.showLinkDirection?"url(#"+r.dom.containerId+"_normalTriangle)":null).classed("dashed",function(o){return"dashed"===o.STYLE}),r.selfLinks=r.dom.svg.selectAll("path.link").data(r.data.links.filter(function(o){return o.FROMID==o.TOID&&r.conf.showSelfLinks}),function(o){return o.FROMID+"_"+o.TOID}),r.selfLinks.enter().append("svg:path").attr("id",function(o){return r.dom.containerId+"_link_"+o.FROMID+"_"+o.TOID}).attr("class","link"),r.selfLinks.exit().remove(),r.selfLinks.attr("d",function(o){return r.tools.getSelfLinkPath(o)}).style("marker-end",r.conf.showLinkDirection?"url(#"+r.dom.containerId+"_normalTriangle)":null).classed("dashed",function(o){return"dashed"==o.STYLE}),r.patterns=r.dom.svgDefs.selectAll("pattern").data(r.data.nodes.filter(function(o){return o.IMAGE?!0:!1}),function(o){return o.ID}),r.patterns.enter().append("svg:pattern").attr("id",function(o){return r.dom.containerId+"_pattern_"+o.ID}).append("svg:image"),r.patterns.exit().remove(),r.patterns.each(function(){d3.select(this).attr("x",0).attr("y",0).attr("height",function(o){return 2*o.radius}).attr("width",function(o){return 2*o.radius}),d3.select(this.firstChild).attr("x",0).attr("y",0).attr("height",function(o){return 2*o.radius}).attr("width",function(o){return 2*o.radius}).attr("xlink:href",function(o){return o.IMAGE})}),r.nodes=r.dom.svg.selectAll("circle.node").data(r.data.nodes,function(o){return o.ID}),r.nodes.enter().append("svg:circle").attr("class","node").on("mouseenter",r.tools.onNodeMouseenter).on("mouseleave",r.tools.onNodeMouseleave).on("click",r.tools.onNodeClick).on("dblclick",r.tools.onNodeDblclick).on("contextmenu",r.tools.onNodeContextmenu),r.nodes.exit().remove(),r.nodes.attr("r",function(o){return o.radius}),r.labels=r.dom.svg.selectAll("text.label").data(r.data.nodes.filter(function(o){return!o.LABELCIRCULAR&&!r.conf.labelsCircular}),function(o){return o.ID}),r.labels.enter().append("svg:text").attr("class","label"),r.labels.exit().remove(),r.labels.text(function(o){return o.LABEL}),r.labelPaths=r.dom.svgDefs.selectAll("path.label").data(r.data.nodes.filter(function(o){return o.LABELCIRCULAR||r.conf.labelsCircular}),function(o){return o.ID}),r.labelPaths.enter().append("svg:path").attr("id",function(o){return r.dom.containerId+"_textPath_"+o.ID}).attr("class","label"),r.labelPaths.exit().remove(),r.labelPaths.attr("d",function(o){return r.tools.getLabelPath(o)}),r.labelsCircular=r.dom.svg.selectAll("text.labelCircular").data(r.data.nodes.filter(function(o){return o.LABELCIRCULAR||r.conf.labelsCircular}),function(o){return o.ID}),r.labelsCircular.enter().append("svg:text").attr("class","labelCircular").append("svg:textPath").attr("xlink:href",function(o){return"#"+r.dom.containerId+"_textPath_"+o.ID}),r.labelsCircular.exit().remove(),r.labelsCircular.each(function(o){d3.select(this.firstChild).text(o.LABEL)}),s.colorScheme(r.conf.colorScheme),s.debug(r.conf.debug),s.alignFixedNodesToGrid(r.conf.alignFixedNodesToGrid),s.dragMode(r.conf.dragMode),s.pinMode(r.conf.pinMode),s.lassoMode(r.conf.lassoMode),r.dom.svg.attr("width",r.conf.useDomParentWidth?r.dom.containerWidth:r.conf.width).attr("height",r.conf.height),r.dom.svgOverlay.attr("width",r.conf.useDomParentWidth?r.dom.containerWidth:r.conf.width).attr("height",r.conf.height),r.force.nodes(r.data.nodes).links(r.data.links).size([r.conf.useDomParentWidth?r.dom.containerWidth:r.conf.width,r.conf.height]).friction(r.conf.friction).charge(r.conf.charge).theta(r.conf.theta).gravity(r.conf.gravity).linkDistance(r.conf.linkDistance).linkStrength(r.conf.linkStrength).start(),s.autoRefresh(r.conf.autoRefresh),r.conf.customize?r.tools.createCustomizeWizard():r.tools.createCustomizeLink(),r.status.graphReady=!0,r.tools.triggerApexEvent(document.querySelector("#"+r.dom.containerId),"apexafterrefresh")}var r={version:"1.1.0"};return r.dom={},r.conf={},r.data={},r.tools={},r.status={},r.tools.parseBool=function(o){switch(String(o).trim().toLowerCase()){case"true":case"yes":case"1":return!0;case"false":case"no":case"0":case"":return!1;default:return!1}},r.dom.containerId=o||"D3Force"+Math.floor(1e6*Math.random()),r.confUser=t||{},r.conf.apexPluginId=e,r.conf.apexPageItemsToSubmit=n,r.conf.debugPrefix="D3 Force in DOM container #"+r.dom.containerId+": ",r.conf.debug=r.conf.apexPluginId&&1==apex.jQuery("#pdebug").length,r.status.forceTickCounter=0,r.status.forceStartTime=0,r.status.forceRunning=!1,r.status.graphStarted=!1,r.status.graphReady=!1,r.status.graphOldPositions=null,r.confDefaults={showBorder:{type:"bool",val:!0,options:[!0,!1]},showSelfLinks:{type:"bool",val:!0,options:[!0,!1]},showLinkDirection:{type:"bool",val:!0,options:[!0,!1]},showTooltips:{type:"bool",val:!0,options:[!0,!1]},tooltipPosition:{type:"text",val:"svgTopRight",options:["node","svgTopLeft","svgTopRight"]},colorScheme:{type:"text",val:"color20",options:["color20","color20b","color20c","color10","direct"]},labelsCircular:{type:"bool",val:!1,options:[!0,!1]},dragMode:{type:"bool",val:!0,options:[!0,!1]},pinMode:{type:"bool",val:!1,options:[!0,!1]},lassoMode:{type:"bool",val:!1,options:[!0,!1]},alignFixedNodesToGrid:{type:"bool",val:!1,options:[!0,!1]},gridSize:{type:"number",val:50,options:[150,140,130,120,110,100,90,80,70,60,50,40,30,20,10]},nodeEventToStopPinMode:{type:"text",val:"contextmenu",options:["none","dblclick","contextmenu"]},onNodeContextmenuPreventDefault:{type:"bool",val:!1,options:[!0,!1]},nodeEventToOpenLink:{type:"text",val:"dblclick",options:["none","click","dblclick","contextmenu"]},nodeLinkTarget:{type:"text",val:"_blank",options:["none","_blank","nodeID","domContainerID"]},autoRefresh:{type:"bool",val:!1,options:[!0,!1]},refreshInterval:{type:"number",val:5e3,options:[6e4,3e4,15e3,1e4,5e3,2500]},useDomParentWidth:{type:"bool",val:!1,options:[!0,!1]},width:{type:"number",val:500,options:[1200,1150,1100,1050,1e3,950,900,850,800,750,700,650,600,550,500,450,400,350,300]},height:{type:"number",val:500,options:[1200,1150,1100,1050,1e3,950,900,850,800,750,700,650,600,550,500,450,400,350,300]},minNodeRadius:{type:"number",val:6,options:[12,11,10,9,8,7,6,5,4,3,2,1]},maxNodeRadius:{type:"number",val:18,options:[36,34,32,30,28,26,24,22,20,18,16,14,12]},labelDistance:{type:"number",val:12,options:[30,28,26,24,22,20,18,16,14,12,10,8,6,4,2]},selfLinkDistance:{type:"number",val:20,options:[30,28,26,24,22,20,18,16,14,12,10,8]},linkDistance:{type:"number",val:80,options:[120,110,100,90,80,70,60,50,40,30,20]},charge:{type:"number",val:-350,options:[-1e3,-950,-900,-850,-800,-750,-700,-650,-600,-550,-500,-450,-400,-350,-300,-250,-200,-150,-100,-50,0],internal:!0},gravity:{type:"number",val:.1,options:[1,.95,.9,.85,.8,.75,.7,.65,.6,.55,.5,.45,.4,.35,.3,.25,.2,.15,.1,.05,0],internal:!0},linkStrength:{type:"number",val:1,options:[1,.95,.9,.85,.8,.75,.7,.65,.6,.55,.5,.45,.4,.35,.3,.25,.2,.15,.1,.05,0],internal:!0},friction:{type:"number",val:.9,options:[1,.95,.9,.85,.8,.75,.7,.65,.6,.55,.5,.45,.4,.35,.3,.25,.2,.15,.1,.05,0],internal:!0},theta:{type:"number",val:.8,options:[1,.95,.9,.85,.8,.75,.7,.65,.6,.55,.5,.45,.4,.35,.3,.25,.2,.15,.1,.05,0],internal:!0}},r.conf.customize=!1,r.conf.debug="undefined"!=typeof r.confUser.debug?r.tools.parseBool(r.confUser.debug):!1,r.conf.showBorder="undefined"!=typeof r.confUser.showBorder?r.tools.parseBool(r.confUser.showBorder):r.confDefaults.showBorder.val,r.conf.showSelfLinks="undefined"!=typeof r.confUser.showSelfLinks?r.tools.parseBool(r.confUser.showSelfLinks):r.confDefaults.showSelfLinks.val,r.conf.showLinkDirection="undefined"!=typeof r.confUser.showLinkDirection?r.tools.parseBool(r.confUser.showLinkDirection):r.confDefaults.showLinkDirection.val,r.conf.showTooltips="undefined"!=typeof r.confUser.showTooltips?r.tools.parseBool(r.confUser.showTooltips):r.confDefaults.showTooltips.val,r.conf.tooltipPosition=r.confUser.tooltipPosition||r.confDefaults.tooltipPosition.val,r.conf.colorScheme=r.confUser.colorScheme||r.confDefaults.colorScheme.val,r.conf.labelsCircular="undefined"!=typeof r.confUser.labelsCircular?r.tools.parseBool(r.confUser.labelsCircular):r.confDefaults.labelsCircular.val,r.conf.dragMode="undefined"!=typeof r.confUser.dragMode?r.tools.parseBool(r.confUser.dragMode):r.confDefaults.dragMode.val,r.conf.pinMode="undefined"!=typeof r.confUser.pinMode?r.tools.parseBool(r.confUser.pinMode):r.confDefaults.pinMode.val,r.conf.lassoMode="undefined"!=typeof r.confUser.lassoMode?r.tools.parseBool(r.confUser.lassoMode):r.confDefaults.lassoMode.val,r.conf.alignFixedNodesToGrid="undefined"!=typeof r.confUser.alignFixedNodesToGrid?r.tools.parseBool(r.confUser.alignFixedNodesToGrid):r.confDefaults.alignFixedNodesToGrid.val,r.conf.gridSize=r.confUser.gridSize&&r.confUser.gridSize>0?r.confUser.gridSize:r.confDefaults.gridSize.val,r.conf.nodeEventToStopPinMode=r.confUser.nodeEventToStopPinMode||r.confDefaults.nodeEventToStopPinMode.val,r.conf.onNodeContextmenuPreventDefault="undefined"!=typeof r.confUser.onNodeContextmenuPreventDefault?r.tools.parseBool(r.confUser.onNodeContextmenuPreventDefault):r.confDefaults.onNodeContextmenuPreventDefault.val,r.conf.nodeEventToOpenLink=r.confUser.nodeEventToOpenLink||r.confDefaults.nodeEventToOpenLink.val,r.conf.nodeLinkTarget=r.confUser.nodeLinkTarget||r.confDefaults.nodeLinkTarget.val,r.conf.autoRefresh="undefined"!=typeof r.confUser.autoRefresh?r.tools.parseBool(r.confUser.autoRefresh):r.confDefaults.autoRefresh.val,r.conf.refreshInterval=r.confUser.refreshInterval||r.confDefaults.refreshInterval.val,r.conf.useDomParentWidth="undefined"!=typeof r.confUser.useDomParentWidth?r.tools.parseBool(r.confUser.useDomParentWidth):r.confDefaults.useDomParentWidth.val,r.conf.width=r.confUser.width||r.confDefaults.width.val,r.conf.height=r.confUser.height||r.confDefaults.height.val,r.conf.minNodeRadius=r.confUser.minNodeRadius||r.confDefaults.minNodeRadius.val,r.conf.maxNodeRadius=r.confUser.maxNodeRadius||r.confDefaults.maxNodeRadius.val,r.conf.labelDistance=r.confUser.labelDistance||r.confDefaults.labelDistance.val,r.conf.selfLinkDistance=r.confUser.selfLinkDistance||r.confDefaults.selfLinkDistance.val,r.conf.linkDistance=r.confUser.linkDistance||r.confDefaults.linkDistance.val,r.conf.chargeDistance=r.confUser.chargeDistance||null,r.conf.charge=r.confUser.charge||r.confDefaults.charge.val,r.conf.gravity=r.confUser.gravity||r.confDefaults.gravity.val,r.conf.linkStrength=r.confUser.linkStrength||r.confDefaults.linkStrength.val,r.conf.friction=r.confUser.friction||r.confDefaults.friction.val,r.conf.theta=r.confUser.theta||r.confDefaults.theta.val,r.conf.onNodeMouseenterFunction=r.confUser.onNodeMouseenterFunction||null,r.conf.onNodeMouseleaveFunction=r.confUser.onNodeMouseleaveFunction||null,r.conf.onNodeClickFunction=r.confUser.onNodeClickFunction||null,r.conf.onNodeDblclickFunction=r.confUser.onNodeDblclickFunction||null,r.conf.onNodeContextmenuFunction=r.confUser.onNodeContextmenuFunction||null,r.conf.onLassoStartFunction=r.confUser.onLassoStartFunction||null,r.conf.onLassoEndFunction=r.confUser.onLassoEndFunction||null,r.conf.currentTabPosition=null,r.conf.sampleData=!1,r.data.sampleData='<data><nodes ID="7839" LABEL="KING is THE KING, you know?" COLORVALUE="10" SIZEVALUE="5000" LABELCIRCULAR="true" LINK="http://apex.oracle.com/" INFOSTRING="This visualization is based on the well known emp table." /><nodes ID="7698" LABEL="BLAKE" COLORVALUE="30" SIZEVALUE="2850" /><nodes ID="7782" LABEL="CLARK" COLORVALUE="10" SIZEVALUE="2450" /><nodes ID="7566" LABEL="JONES" COLORVALUE="20" SIZEVALUE="2975" /><nodes ID="7788" LABEL="SCOTT" COLORVALUE="20" SIZEVALUE="3000" /><nodes ID="7902" LABEL="FORD" COLORVALUE="20" SIZEVALUE="3000" /><nodes ID="7369" LABEL="SMITH" COLORVALUE="20" SIZEVALUE="800" /><nodes ID="7499" LABEL="ALLEN" COLORVALUE="30" SIZEVALUE="1600" /><nodes ID="7521" LABEL="WARD" COLORVALUE="30" SIZEVALUE="1250" /><nodes ID="7654" LABEL="MARTIN" COLORVALUE="30" SIZEVALUE="1250" /><nodes ID="7844" LABEL="TURNER" COLORVALUE="30" SIZEVALUE="1500" /><nodes ID="7876" LABEL="ADAMS" COLORVALUE="20" SIZEVALUE="1100" /><nodes ID="7900" LABEL="JAMES" COLORVALUE="30" SIZEVALUE="950" /><nodes ID="7934" LABEL="MILLER" COLORVALUE="10" SIZEVALUE="1300" /><nodes ID="8888" LABEL="Who am I?" COLORVALUE="green" SIZEVALUE="2000" LINK="https://github.com/ogobrecht/d3-force-apex-plugin/wiki/API-Reference#nodelinktarget" INFOSTRING="This is a good question. Think about it." /><nodes ID="9999" LABEL="Where I am?" COLORVALUE="#f00" SIZEVALUE="1000" LINK="https://github.com/ogobrecht/d3-force-apex-plugin/wiki/API-Reference#nodelinktarget" INFOSTRING="This is a good question. What do you think?" /><links FROMID="7839" TOID="7839" STYLE="dashed" /><links FROMID="7698" TOID="7839" STYLE="solid" /><links FROMID="7782" TOID="7839" STYLE="solid" /><links FROMID="7566" TOID="7839" STYLE="solid" /><links FROMID="7788" TOID="7566" STYLE="solid" /><links FROMID="7902" TOID="7566" STYLE="solid" /><links FROMID="7369" TOID="7902" STYLE="solid" /><links FROMID="7499" TOID="7698" STYLE="solid" /><links FROMID="7521" TOID="7698" STYLE="solid" /><links FROMID="7654" TOID="7698" STYLE="solid" /><links FROMID="7844" TOID="7698" STYLE="solid" /><links FROMID="7876" TOID="7788" STYLE="solid" /><links FROMID="7900" TOID="7698" STYLE="solid" /><links FROMID="7934" TOID="7782" STYLE="solid" /></data>',null===document.querySelector("#"+r.dom.containerId)?r.dom.container=d3.select("body").append("div").attr("id",r.dom.containerId):(r.dom.container=d3.select("#"+r.dom.containerId),d3.selectAll("#"+r.dom.containerId+"_tooltip, #"+r.dom.containerId+"_customizing").remove()),null===document.querySelector("#"+r.dom.containerId+" svg")?r.dom.svg=r.dom.container.append("svg"):(r.dom.svg=d3.select("#"+r.dom.containerId+" svg"),d3.selectAll("#"+r.dom.containerId+" svg *").remove()),r.dom.svg.attr("id",r.dom.containerId+"_svg").attr("class","net_gobrechts_d3_force").classed("border",r.conf.showBorder).attr("width",r.conf.width).attr("height",r.conf.height),r.dom.svgOverlay=r.dom.svg.append("rect").attr("class","overlay").attr("width",r.conf.width).attr("height",r.conf.height),r.dom.svgDefs=r.dom.svg.append("defs"),r.dom.svgDefs.append("svg:marker").attr("id",r.dom.containerId+"_highlightedTriangle").attr("class","highlighted").attr("viewBox","0 0 10 10").attr("refX",10).attr("refY",5).attr("markerWidth",5).attr("markerHeight",5).attr("orient","auto").attr("markerUnits","strokeWidth").append("svg:path").attr("d","M0,0 L10,5 L0,10"),r.dom.svgDefs.append("svg:marker").attr("id",r.dom.containerId+"_normalTriangle").attr("class","normal").attr("viewBox","0 0 10 10").attr("refX",10).attr("refY",5).attr("markerWidth",5).attr("markerHeight",5).attr("orient","auto").attr("markerUnits","strokeWidth").append("svg:path").attr("d","M0,0 L10,5 L0,10"),r.dom.tooltip=r.dom.container.append("div").attr("id",r.dom.containerId+"_tooltip").attr("class","net_gobrechts_d3_force_tooltip").style("top","0px").style("left","0px"),r.tools.log=function(o,t){r.conf.debug&&console.log(t?o:r.conf.debugPrefix+o),r.conf.customize&&r.conf.domCustomizeLog&&r.conf.domCustomizeLog.text(o+"\n"+r.conf.domCustomizeLog.text())},r.tools.logError=function(o){console.log(r.conf.debugPrefix+"ERROR: "+o),r.conf.customize&&r.conf.domCustomizeLog&&r.conf.domCustomizeLog.text("ERROR: "+o+"\n"+r.conf.domCustomizeLog.text())},r.tools.triggerApexEvent=function(o,t,e){r.conf.apexPluginId&&apex.event.trigger(o,t,e)},r.tools.setRadiusFunction=function(){r.tools.radius=d3.scale.sqrt().range([r.conf.minNodeRadius,r.conf.maxNodeRadius]).domain(d3.extent(r.data.nodes,function(o){return parseFloat(o.SIZEVALUE)}))},r.tools.neighboring=function(o,t){return r.data.neighbors.indexOf(o.ID+":"+t.ID)>-1||r.data.neighbors.indexOf(t.ID+":"+o.ID)>-1},r.tools.getNearestGridPosition=function(o,t){o=Math.round(o);var e,n;return o>=t?(e=t%r.conf.gridSize,n=t-e,(n=t)&&(n-=r.conf.gridSize)):0>=o?n=r.conf.gridSize:(e=o%r.conf.gridSize,n=e>r.conf.gridSize/2?o-e+r.conf.gridSize:o-e,n>=t&&(n-=r.conf.gridSize)),n},r.tools.adjustSourceX=function(o){return o.source.x+Math.cos(r.tools.calcAngle(o))*o.source.radius},r.tools.adjustSourceY=function(o){return o.source.y+Math.sin(r.tools.calcAngle(o))*o.source.radius},r.tools.adjustTargetX=function(o){return o.target.x-Math.cos(r.tools.calcAngle(o))*o.target.radius},r.tools.adjustTargetY=function(o){return o.target.y-Math.sin(r.tools.calcAngle(o))*o.target.radius},r.tools.calcAngle=function(o){return Math.atan2(o.target.y-o.source.y,o.target.x-o.source.x)},r.tools.getSelfLinkPath=function(o){var t=o.source.radius,e=o.source.radius+r.conf.selfLinkDistance,n=0,s=0,a={source:{x:0,y:0,radius:t},target:{x:n+e/2,y:s+e,radius:t}},i={source:{x:n-e/2,y:s+e,radius:t},target:{x:n,y:s,radius:t}},c="M"+r.tools.adjustSourceX(a)+","+r.tools.adjustSourceY(a);return c+=" L"+(n+e/2)+","+(s+e),c+=" A"+e+","+e+" 0 0,1 "+(n-e/2)+","+(s+e),c+=" L"+r.tools.adjustTargetX(i)+","+r.tools.adjustTargetY(i)},r.tools.getLabelPath=function(o){var t=o.radius+r.conf.labelDistance,e=0,n=0,s="M"+(e-t)+","+n;return s+=" a"+t+","+t+" 0 0,1 "+2*t+",0",s+=" a"+t+","+t+" 0 0,1 -"+2*t+",0"},r.tools.openLink=function(o){var t;"none"==r.conf.nodeLinkTarget?window.location.assign(o.LINK):"nodeID"==r.conf.nodeLinkTarget?(t=window.open(o.LINK,o.ID),t.focus()):"domContainerID"==r.conf.nodeLinkTarget?(t=window.open(o.LINK,r.dom.containerId),t.focus()):(t=window.open(o.LINK,r.conf.nodeLinkTarget),t.focus())},r.tools.onNodeMouseenter=function(o){var t;r.nodes.classed("highlighted",function(t){return r.tools.neighboring(t,o)}),r.links.classed("highlighted",function(t){return t.source.ID==o.ID||t.target.ID==o.ID}).style("marker-end",function(t){return r.conf.showLinkDirection?"url(#"+r.dom.containerId+"_"+(t.source.ID==o.ID||t.target.ID==o.ID?"highlighted":"normal")+"Triangle)":null}),r.selfLinks.classed("highlighted",function(t){return t.FROMID==o.ID}).style("marker-end",function(t){return r.conf.showLinkDirection?"url(#"+r.dom.containerId+"_"+(t.source.ID==o.ID||t.target.ID==o.ID?"highlighted":"normal")+"Triangle)":null}),d3.select(this).classed("highlighted",!0),r.tools.log("Event mouseenter triggered."),r.tools.triggerApexEvent(this,"net_gobrechts_d3_force_mouseenter",o),"function"==typeof r.conf.onNodeMouseenterFunction&&r.conf.onNodeMouseenterFunction.call(this,d3.event,o),r.conf.showTooltips&&o.INFOSTRING&&(r.dom.tooltip.html(o.INFOSTRING).style("display","block"),"svgTopLeft"===r.conf.tooltipPosition?(t=r.tools.getOffsetRect(document.querySelector("#"+r.dom.containerId+" svg")),r.dom.tooltip.style("top",t.top+(r.dom.svg.style("border-width")?parseInt(r.dom.svg.style("border-width")):1)+"px").style("left",t.left+(r.dom.svg.style("border-width")?parseInt(r.dom.svg.style("border-width")):1)+"px")):"svgTopRight"===r.conf.tooltipPosition?(t=r.tools.getOffsetRect(document.querySelector("#"+r.dom.containerId+" svg")),r.dom.tooltip.style("top",t.top+parseInt(r.dom.svg.style("border-width")?parseInt(r.dom.svg.style("border-width")):1)+"px").style("left",t.left+parseInt(r.dom.svg.style("width"))+parseInt(r.dom.svg.style("border-width")?parseInt(r.dom.svg.style("border-width")):1)-parseInt(r.dom.tooltip.style("width"))-2*parseInt(r.dom.tooltip.style("border-width")?parseInt(r.dom.tooltip.style("border-width")):0)-parseInt(r.dom.tooltip.style("padding-left"))-parseInt(r.dom.tooltip.style("padding-right"))+"px")):r.dom.tooltip.style("left",d3.event.pageX+"px").style("top",d3.event.pageY+"px"))},r.tools.onNodeMouseleave=function(o){r.nodes.classed("highlighted",!1),r.links.classed("highlighted",!1).style("marker-end",r.conf.showLinkDirection?"url(#"+r.dom.containerId+"_normalTriangle)":null),r.selfLinks.classed("highlighted",!1).style("marker-end",r.conf.showLinkDirection?"url(#"+r.dom.containerId+"_normalTriangle)":null),r.labels.classed("highlighted",!1),r.tools.log("Event mouseleave triggered."),r.tools.triggerApexEvent(this,"net_gobrechts_d3_force_mouseleave",o),"function"==typeof r.conf.onNodeMouseleaveFunction&&r.conf.onNodeMouseleaveFunction.call(this,d3.event,o),r.conf.showTooltips&&r.dom.tooltip.style("display","none")},r.tools.onNodeClick=function(o){return d3.event.defaultPrevented?null:(o.LINK&&"click"==r.conf.nodeEventToOpenLink&&r.tools.openLink(o),"click"==r.conf.nodeEventToStopPinMode&&d3.select(this).classed("fixed",o.fixed=0),r.tools.log("Event click triggered."),r.tools.triggerApexEvent(this,"net_gobrechts_d3_force_click",o),"function"==typeof r.conf.onNodeClickFunction&&r.conf.onNodeClickFunction.call(this,d3.event,o),void 0)},r.tools.onNodeDblclick=function(o){o.LINK&&"dblclick"==r.conf.nodeEventToOpenLink&&r.tools.openLink(o),"dblclick"==r.conf.nodeEventToStopPinMode&&d3.select(this).classed("fixed",o.fixed=0),r.tools.log("Event dblclick triggered."),r.tools.triggerApexEvent(this,"net_gobrechts_d3_force_dblclick",o),"function"==typeof r.conf.onNodeDblclickFunction&&r.conf.onNodeDblclickFunction.call(this,d3.event,o)},r.tools.onNodeContextmenu=function(o){r.conf.onNodeContextmenuPreventDefault&&d3.event.preventDefault(),o.LINK&&"contextmenu"==r.conf.nodeEventToOpenLink&&r.tools.openLink(o),"contextmenu"==r.conf.nodeEventToStopPinMode&&d3.select(this).classed("fixed",o.fixed=0),r.tools.log("Event contextmenu triggered."),r.tools.triggerApexEvent(this,"net_gobrechts_d3_force_contextmenu",o),"function"==typeof r.conf.onNodeContextmenuFunction&&r.conf.onNodeContextmenuFunction.call(this,d3.event,o)},r.tools.onLassoStart=function(o){var t={};t.nodes=o,t.numberOfNodes=o.size(),t.numberOfSelectedNodes=0,t.idsOfSelectedNodes=null,r.tools.log("Event lassostart triggered."),r.tools.triggerApexEvent(document.querySelector("#"+r.dom.containerId),"net_gobrechts_d3_force_lassostart",t),"function"==typeof r.conf.onLassoStartFunction&&r.conf.onLassoStartFunction.call(r.dom.svg,d3.event,t)},r.tools.onLassoEnd=function(o){var t={};t.nodes=o,t.numberOfNodes=o.size(),t.numberOfSelectedNodes=0,t.idsOfSelectedNodes="",o.each(function(o){o.selected&&(t.idsOfSelectedNodes+=o.ID+":",t.numberOfSelectedNodes++)}),t.idsOfSelectedNodes=t.idsOfSelectedNodes.length>0?t.idsOfSelectedNodes.substr(0,t.idsOfSelectedNodes.length-1):null,r.tools.log("Event lassoend triggered."),r.tools.triggerApexEvent(document.querySelector("#"+r.dom.containerId),"net_gobrechts_d3_force_lassoend",t),"function"==typeof r.conf.onLassoEndFunction&&r.conf.onLassoEndFunction.call(r.dom.svg,d3.event,t)},r.tools.x2js=new X2JS({attributePrefix:"none"}),r.tools.getSvgParentInnerWidth=function(){var o=d3.select(r.dom.svg.node().parentNode);return parseInt(o.style("width"))-parseInt(o.style("padding-left"))-parseInt(o.style("padding-right"))-2*(r.dom.svg.style("border-width")?parseInt(r.dom.svg.style("border-width")):1)},r.tools.getOffsetRect=function(o){var t=o.getBoundingClientRect(),e=document.body,n=document.documentElement,s=window.pageYOffset||n.scrollTop||e.scrollTop,r=window.pageXOffset||n.scrollLeft||e.scrollLeft,a=n.clientTop||e.clientTop||0,i=n.clientLeft||e.clientLeft||0,c=t.top+s-a,d=t.left+r-i;return{top:Math.round(c),left:Math.round(d)}},r.tools.createCustomizeLink=function(){!r.conf.customize&&(r.conf.debug||document.querySelector("#apex-dev-toolbar")||document.querySelector("#apexDevToolbar"))&&null===document.querySelector("#"+r.dom.containerId+" svg text.link")&&r.dom.svg.append("svg:text").attr("class","link").attr("x",5).attr("y",15).attr("text-anchor","start").text("Customize Me").on("click",function(){s.customize(!0)})},r.tools.removeCustomizeLink=function(){r.dom.svg.select("#"+r.dom.containerId+" svg text.link").remove()},r.tools.customizeDrag=d3.behavior.drag().on("dragstart",function(){var o=d3.mouse(document.body);r.conf.domCustomizePosition=r.tools.getOffsetRect(document.querySelector("#"+r.dom.containerId+"_customizing")),r.conf.domCustomizePosition.mouseLeft=o[0]-r.conf.domCustomizePosition.left,r.conf.domCustomizePosition.mouseTop=o[1]-r.conf.domCustomizePosition.top}).on("drag",function(){var o=d3.mouse(document.body);r.conf.domCustomize.style("left",Math.max(0,o[0]-r.conf.domCustomizePosition.mouseLeft)+"px").style("top",Math.max(0,o[1]-r.conf.domCustomizePosition.mouseTop)+"px")}).on("dragend",function(){r.conf.domCustomizePosition=r.tools.getOffsetRect(r.conf.domCustomize.node())}),r.tools.createCustomizeWizard=function(){if(r.conf.customize){var o,t,e,n,a,i,c,d=0;r.tools.removeCustomizeLink(),r.conf.domCustomizePosition||(r.conf.domCustomizePosition=r.tools.getOffsetRect(r.dom.svg.node()),r.conf.domCustomizePosition.left=r.conf.domCustomizePosition.left+r.conf.width+8),null!==document.querySelector("#"+r.dom.containerId+"_customizing")&&r.conf.domCustomize.remove(),r.conf.domCustomize=r.dom.container.append("div").attr("id",r.dom.containerId+"_customizing").attr("class","net_gobrechts_d3_force_customize").style("left",r.conf.domCustomizePosition.left+"px").style("top",r.conf.domCustomizePosition.top+"px"),r.conf.domCustomize.append("span").attr("class","drag").call(r.tools.customizeDrag).append("span").attr("class","title").text('Customize "'+r.dom.containerId+'"'),r.conf.domCustomize.append("a").attr("class","close focus").attr("tabindex",1).text("Close").on("click",function(){r.conf.customize=!1,r.tools.removeCustomizeWizard(),r.tools.createCustomizeLink()}).on("keydown",function(){13==d3.event.keyCode&&(r.conf.customize=!1,r.tools.removeCustomizeWizard(),r.tools.createCustomizeLink())}),o=r.conf.domCustomize.append("table");for(var l in r.confDefaults)r.confDefaults.hasOwnProperty(l)&&(d+=1,t=o.append("tr"),t.append("td").attr("class","label").html('<a href="https://github.com/ogobrecht/d3-force-apex-plugin/wiki/API-Reference#'+l.toLowerCase()+'" target="github_d3_force" tabindex="'+d+'100">'+l+"</a>"),e=t.append("td"),n=e.append("select").attr("id",r.dom.containerId+"_"+l).attr("name",l).attr("value",r.conf[l]).attr("tabindex",d+1).classed("warning",r.confDefaults[l].internal).on("change",function(){r.conf.currentTabPosition=this.id,"text"==r.confDefaults[this.name].type?r.conf[this.name]=this.options[this.selectedIndex].value:"number"==r.confDefaults[this.name].type?r.conf[this.name]=parseFloat(this.options[this.selectedIndex].value):"bool"==r.confDefaults[this.name].type&&(r.conf[this.name]="true"==this.options[this.selectedIndex].value),s()}),c=!1,r.confDefaults[l].options.forEach(function(o){i=o,n.append("option").attr("value",o).attr("selected",function(){return"text"==r.confDefaults[l].type||"bool"==r.confDefaults[l].type?i==r.conf[l]?(c=!0,"selected"):null:"number"==r.confDefaults[l].type?parseFloat(i)==r.conf[l]?(c=!0,"selected"):null:void 0}).text(o)}),c||(n.append("option").attr("value",r.conf[l]).attr("selected","selected").text(r.conf[l]),r.confDefaults[l].options.push(r.conf[l])),1==d&&(a=t.append("td").style("vertical-align","top").style("padding-left","5px")));a.attr("rowspan",d).html('Your Configuration Object<br><textarea id="'+r.dom.containerId+'_conf_object" tabindex="'+(d+2)+'" readonly></textarea><br><br>Current Positions<br><textarea id="'+r.dom.containerId+'_positions" tabindex="'+(d+3)+'" readonly>'+(r.status.forceRunning?"Force started - wait for end event to show positions...":JSON.stringify(s.positions()))+'</textarea><br><br>Debug Log (descending)<br><textarea id="'+r.dom.containerId+'_log" tabindex="'+(d+4)+'" readonly></textarea><br><br>Copyrights<br><br><a href="https://github.com/ogobrecht/d3-force-apex-plugin" target="github_d3_force" tabindex="'+(d+5)+'">D3 Force APEX Plugin</a> ('+r.version+')<br>Ottmar Gobrecht<br><br><a href="http://d3js.org" target="d3js_org" tabindex="'+(d+6)+'">D3.js</a> ('+d3.version+')<br>Mike Bostock<br><br><a href="https://code.google.com/p/x2js/" target="code_google_com" tabindex="'+(d+7)+'">X2JS</a> ('+r.tools.x2js.getVersion()+" modified)<br>Abdulla Abdurakhmanov<br><br>"),r.conf.domCustomizeConfObject=d3.select("#"+r.dom.containerId+"_conf_object"),r.conf.domCustomizePositions=d3.select("#"+r.dom.containerId+"_positions"),r.conf.domCustomizeLog=d3.select("#"+r.dom.containerId+"_log"),r.tools.createCustomizingConfObject(),r.conf.currentTabPosition?document.getElementById(r.conf.currentTabPosition).focus():document.querySelector("#"+r.dom.containerId+"_customizing select").focus()
}else r.tools.removeCustomizeWizard(),r.tools.createCustomizeLink()},r.tools.removeCustomizeWizard=function(){d3.select("#"+r.dom.containerId+"_customizing").remove()},r.tools.createCustomizingConfObject=function(){var o="{\n";for(var t in r.confDefaults)r.confDefaults.hasOwnProperty(t)&&(o+="range"==r.confDefaults[t].type||"number"==r.confDefaults[t].type||"bool"==r.confDefaults[t].type?'"'+t+'":'+r.conf[t]+",\n":'"'+t+'":"'+r.conf[t]+'",\n');o=o.substr(0,o.length-2)+"\n}",r.conf.domCustomizeConfObject.text(o)},r.conf.userAgent=navigator.userAgent,r.conf.userAgent_IE_9_to_11=!1,(-1!==navigator.appVersion.indexOf("MSIE 9")||-1!==navigator.appVersion.indexOf("MSIE 10")||-1!==r.conf.userAgent.indexOf("Trident")&&-1!==r.conf.userAgent.indexOf("rv:11"))&&(r.conf.userAgent_IE_9_to_11=!0,r.tools.logError("Houston, we have a problem - user agent is IE 9, 10 or 11 - we have to provide a fix for markers: http://stackoverflow.com/questions/15588478/internet-explorer-10-not-showing-svg-path-d3-js-graph")),r.force=d3.layout.force().on("start",function(){r.tools.log("Force started."),r.conf.customize&&r.conf.domCustomizePositions&&r.conf.domCustomizePositions.text("Force started - wait for end event to show positions..."),r.status.forceTickCounter=0,r.status.forceStartTime=(new Date).getTime(),r.status.forceRunning=!0}).on("tick",function(){r.conf.userAgent_IE_9_to_11&&r.conf.showLinkDirection&&(r.links.each(function(){this.parentNode.insertBefore(this,this)}),r.selfLinks.each(function(){this.parentNode.insertBefore(this,this)})),r.selfLinks.attr("transform",function(o){return"translate("+o.source.x+","+o.source.y+")"}),r.links.attr("x1",function(o){return r.tools.adjustSourceX(o)}).attr("y1",function(o){return r.tools.adjustSourceY(o)}).attr("x2",function(o){return r.tools.adjustTargetX(o)}).attr("y2",function(o){return r.tools.adjustTargetY(o)}),r.labels.attr("x",function(o){return o.x}).attr("y",function(o){return o.y-o.radius-r.conf.labelDistance}),r.labelPaths.attr("transform",function(o){return"translate("+o.x+","+o.y+")"}),r.nodes.attr("cx",function(o){return o.x}).attr("cy",function(o){return o.y}),r.status.forceTickCounter+=1}).on("end",function(){r.status.forceRunning=!1;var o=(new Date).getTime()-r.status.forceStartTime,t=(o/1e3).toFixed(1),e=Math.round(r.status.forceTickCounter/(o/1e3)),n=Math.round(o/r.status.forceTickCounter);r.conf.customize&&r.conf.domCustomizePositions&&r.conf.domCustomizePositions.text(JSON.stringify(s.positions())),r.tools.log("Force ended."),r.tools.log(t+" seconds, "+r.status.forceTickCounter+" ticks to cool down ("+e+" ticks/s, "+n+" ms/tick).")}),r.drag=r.force.drag(),r.lasso=d3.lasso().closePathDistance(100).closePathSelect(!0).hoverSelect(!0).area(r.dom.svgOverlay),s.start=function(o){var t;return o?s(o):r.conf.apexPluginId?apex.server.plugin(r.conf.apexPluginId,{p_debug:$v("pdebug"),pageItems:r.conf.apexPageItemsToSubmit.split(",")},{success:function(o){t=o.trim().substr(0,1),"<"==t||"{"==t?s(o):"no_query_defined"==o.trim().substr(0,16)?(s(),r.tools.logError("No query defined.")):"query_returned_no_data"==o.trim().substr(0,22)?(s('{"data":{"nodes":[{"ID":"1","LABEL":"ERROR: No data.","COLORVALUE":"1","SIZEVALUE":"1"}],"links":[]}}'),r.tools.logError("Query returned no data.")):(s('{"data":{"nodes":[{"ID":"1","LABEL":"ERROR: '+o+'.","COLORVALUE":"1","SIZEVALUE":"1"}],"links":[]}}'),r.tools.logError(o))},error:function(o,t,e){s('{"data":{"nodes":[{"ID":"1","LABEL":"AJAX call terminated with errors.","COLORVALUE":"1","SIZEVALUE":"1"}],"links":[]}}'),r.tools.logError("AJAX call terminated with errors: "+e+".")},dataType:"text"}):s(),s},s.render=function(o){return s(o),s},s.resume=function(){return r.force.resume(),r.conf.customize&&r.tools.createCustomizeWizard(),s},s.showBorder=function(o){return arguments.length?(r.conf.showBorder=o,r.status.graphStarted&&(r.dom.svg.classed("border",r.conf.showBorder),r.conf.customize&&r.tools.createCustomizeWizard()),s):r.conf.showBorder},s.showSelfLinks=function(o){return arguments.length?(r.conf.showSelfLinks=o,r.status.graphStarted&&r.conf.customize&&r.tools.createCustomizeWizard(),s):r.conf.showSelfLinks},s.showLinkDirection=function(o){return arguments.length?(r.conf.showLinkDirection=o,r.status.graphStarted&&r.conf.customize&&r.tools.createCustomizeWizard(),s):r.conf.showLinkDirection},s.showTooltips=function(o){return arguments.length?(r.conf.showTooltips=o,r.status.graphStarted&&r.conf.customize&&r.tools.createCustomizeWizard(),s):r.conf.showTooltips},s.tooltipPosition=function(o){return arguments.length?(r.conf.tooltipPosition=o,r.status.graphStarted&&r.conf.customize&&r.tools.createCustomizeWizard(),s):r.conf.tooltipPosition},s.colorScheme=function(o){return arguments.length?(r.conf.colorScheme=o,r.status.graphStarted&&("color20"==r.conf.colorScheme?r.tools.color=d3.scale.category20():"color20b"==r.conf.colorScheme?r.tools.color=d3.scale.category20b():"color20c"==r.conf.colorScheme?r.tools.color=d3.scale.category20c():"color10"==r.conf.colorScheme?r.tools.color=d3.scale.category10():"direct"==r.conf.colorScheme?r.tools.color=function(o){return o}:(r.conf.colorScheme="color20",r.tools.color=d3.scale.category20()),r.nodes.style("fill",null).style("fill",function(o){return o.IMAGE?"url(#"+r.dom.containerId+"_pattern_"+o.ID+")":r.tools.color(o.COLORVALUE)}),r.conf.customize&&r.tools.createCustomizeWizard()),s):r.conf.colorScheme},s.labelsCircular=function(o){return arguments.length?(r.conf.labelsCircular=o,r.status.graphStarted&&r.conf.customize&&r.tools.createCustomizeWizard(),s):r.conf.labelsCircular},s.dragMode=function(o){return arguments.length?(r.conf.dragMode=o,r.status.graphStarted&&(r.conf.dragMode?r.nodes.call(r.drag):r.nodes.on("mousedown.drag",null),r.conf.customize&&r.tools.createCustomizeWizard()),s):r.conf.dragMode},s.pinMode=function(o){return arguments.length?(r.conf.pinMode=o,r.status.graphStarted&&(r.conf.pinMode?r.drag.on("dragstart",function(o){d3.select(this).classed("fixed",o.fixed=1)}):r.drag.on("dragstart",null),r.conf.customize&&r.tools.createCustomizeWizard()),s):r.conf.pinMode},s.lassoMode=function(o){return arguments.length?(r.conf.lassoMode=o,r.status.graphStarted&&(r.conf.lassoMode?(r.dom.svg.call(r.lasso),r.lasso.items(r.nodes),r.lasso.on("start",function(){r.lasso.items().classed("selected",!1),r.tools.onLassoStart(r.lasso.items())}),r.lasso.on("draw",function(){r.lasso.items().filter(function(o){return o.possible===!0}).classed("selected",!0),r.lasso.items().filter(function(o){return o.possible===!1}).classed("selected",!1)}),r.lasso.on("end",function(){r.lasso.items().filter(function(o){return o.selected===!0}).classed("selected",!0),r.lasso.items().filter(function(o){return o.selected===!1}).classed("selected",!1),r.tools.onLassoEnd(r.lasso.items())})):(r.dom.svgOverlay.on("mousedown.drag",null),r.nodes.classed("selected",!1)),r.conf.customize&&r.tools.createCustomizeWizard()),s):r.conf.lassoMode},s.alignFixedNodesToGrid=function(o){return arguments.length?(r.conf.alignFixedNodesToGrid=o,r.status.graphStarted&&(r.conf.alignFixedNodesToGrid?(r.nodes.each(function(o){o.fixed&&(o.x=o.px=r.tools.getNearestGridPosition(o.x,r.conf.width),o.y=o.py=r.tools.getNearestGridPosition(o.y,r.conf.height))}),r.drag.on("dragend",function(o){o.x=o.px=r.tools.getNearestGridPosition(o.x,r.conf.width),o.y=o.py=r.tools.getNearestGridPosition(o.y,r.conf.height)})):r.drag.on("dragend",null),r.conf.customize&&r.tools.createCustomizeWizard()),s):r.conf.alignFixedNodesToGrid},s.moveFixedNodes=function(o,t){return r.status.graphStarted&&(o||(o=0),t||(t=0),(0!=o||0!=t)&&r.nodes.each(function(e){e.fixed&&(e.x=e.px=r.conf.alignFixedNodesToGrid?r.tools.getNearestGridPosition(e.x+o,r.conf.width):e.x+o,e.y=e.py=r.conf.alignFixedNodesToGrid?r.tools.getNearestGridPosition(e.y+t,r.conf.width):e.y+t)})),s},s.gridSize=function(o){return arguments.length?(r.conf.gridSize=o,r.status.graphStarted&&r.conf.customize&&r.tools.createCustomizeWizard(),s):r.conf.gridSize},s.nodeEventToStopPinMode=function(o){return arguments.length?(r.conf.nodeEventToStopPinMode=o,r.status.graphStarted&&r.conf.customize&&r.tools.createCustomizeWizard(),s):r.conf.nodeEventToStopPinMode},s.onNodeContextmenuPreventDefault=function(o){return arguments.length?(r.conf.onNodeContextmenuPreventDefault=o,r.status.graphStarted&&r.conf.customize&&r.tools.createCustomizeWizard(),s):r.conf.onNodeContextmenuPreventDefault},s.nodeEventToOpenLink=function(o){return arguments.length?(r.conf.nodeEventToOpenLink=o,r.status.graphStarted&&r.conf.customize&&r.tools.createCustomizeWizard(),s):r.conf.nodeEventToOpenLink},s.nodeLinkTarget=function(o){return arguments.length?(r.conf.nodeLinkTarget=o,r.status.graphStarted&&r.conf.customize&&r.tools.createCustomizeWizard(),s):r.conf.nodeLinkTarget},s.autoRefresh=function(o){return arguments.length?(r.conf.autoRefresh=o,r.status.graphStarted&&(r.conf.autoRefresh&&r.conf.refreshInterval&&!r.conf.interval?(r.conf.interval=window.setInterval(function(){s.start()},r.conf.refreshInterval),r.tools.log("Auto refresh started with an interval of "+r.conf.refreshInterval+" milliseconds.")):!r.conf.autoRefresh&&r.conf.interval&&(clearInterval(r.conf.interval),r.conf.interval=null,r.tools.log("Auto refresh stopped.")),r.conf.customize&&r.tools.createCustomizeWizard()),s):r.conf.autoRefresh},s.refreshInterval=function(o){return arguments.length?(r.conf.refreshInterval=o,r.status.graphStarted&&r.conf.customize&&r.tools.createCustomizeWizard(),s):r.conf.refreshInterval},s.useDomParentWidth=function(o){return arguments.length?(r.conf.useDomParentWidth=o,r.status.graphStarted&&(r.conf.useDomParentWidth?(r.dom.containerWidth=r.tools.getSvgParentInnerWidth(),d3.select(window).on("resize",function(){var o=r.dom.containerWidth,t=r.tools.getSvgParentInnerWidth();o!==t&&(r.dom.containerWidth=t,s())})):d3.select(window).on("resize",null),r.conf.customize&&r.tools.createCustomizeWizard()),s):r.conf.useDomParentWidth},s.width=function(o){return arguments.length?(r.conf.width=o,r.status.graphStarted&&r.conf.customize&&r.tools.createCustomizeWizard(),s):r.conf.width},s.height=function(o){return arguments.length?(r.conf.height=o,r.status.graphStarted&&r.conf.customize&&r.tools.createCustomizeWizard(),s):r.conf.height},s.minNodeRadius=function(o){return arguments.length?(r.conf.minNodeRadius=o,r.status.graphReady&&(r.tools.setRadiusFunction(),r.nodes.each(function(o){o.radius=r.tools.radius(o.SIZEVALUE)}),r.nodes.attr("r",function(o){return o.radius}),r.conf.customize&&r.tools.createCustomizeWizard()),s):r.conf.minNodeRadius},s.maxNodeRadius=function(o){return arguments.length?(r.conf.maxNodeRadius=o,r.status.graphReady&&(r.tools.setRadiusFunction(),r.nodes.each(function(o){o.radius=r.tools.radius(o.SIZEVALUE)}),r.nodes.attr("r",function(o){return o.radius}),r.conf.customize&&r.tools.createCustomizeWizard()),s):r.conf.maxNodeRadius},s.labelDistance=function(o){return arguments.length?(r.conf.labelDistance=o,r.status.graphStarted&&r.conf.customize&&r.tools.createCustomizeWizard(),s):r.conf.labelDistance},s.selfLinkDistance=function(o){return arguments.length?(r.conf.selfLinkDistance=o,r.status.graphStarted&&r.conf.customize&&r.tools.createCustomizeWizard(),s):r.conf.selfLinkDistance},s.linkDistance=function(o){return arguments.length?(r.conf.linkDistance=o,r.status.graphStarted&&r.conf.customize&&r.tools.createCustomizeWizard(),s):r.conf.linkDistance},s.charge=function(o){return arguments.length?(r.conf.charge=o,r.status.graphStarted&&r.conf.customize&&r.tools.createCustomizeWizard(),s):r.conf.charge},s.gravity=function(o){return arguments.length?(r.conf.gravity=o,r.status.graphStarted&&r.conf.customize&&r.tools.createCustomizeWizard(),s):r.conf.gravity},s.chargeDistance=function(o){return arguments.length?(r.conf.chargeDistance=o,r.status.graphStarted&&r.conf.customize&&r.tools.createCustomizeWizard(),s):r.conf.chargeDistance},s.linkStrength=function(o){return arguments.length?(r.conf.linkStrength=o,r.status.graphStarted&&r.conf.customize&&r.tools.createCustomizeWizard(),s):r.conf.linkStrength},s.friction=function(o){return arguments.length?(r.conf.friction=o,r.status.graphStarted&&r.conf.customize&&r.tools.createCustomizeWizard(),s):r.conf.friction},s.theta=function(o){return arguments.length?(r.conf.theta=o,r.status.graphStarted&&r.conf.customize&&r.tools.createCustomizeWizard(),s):r.conf.theta},s.positions=function(o){if(arguments.length)return r.status.graphReady?o.constructor===Array?o.forEach(function(o){void 0!==r.data.id_lookup[o.ID]&&(r.data.id_lookup[o.ID].fixed=r.tools.parseBool(o.fixed),r.data.id_lookup[o.ID].x=r.data.id_lookup[o.ID].px=o.x,r.data.id_lookup[o.ID].y=r.data.id_lookup[o.ID].py=o.y)}):r.tools.logError("Unable to set node positions: positions method parameter must be an array of node positions"):r.conf.positions=o,s;var t=[];return r.data.nodes.forEach(function(o){t.push({ID:o.ID,x:Math.round(o.x),y:Math.round(o.y),fixed:o.fixed?1:0})}),t},s.onNodeMouseenterFunction=function(o){return arguments.length?(r.conf.onNodeMouseenterFunction=o,s):r.conf.onNodeMouseenterFunction},s.onNodeMouseleaveFunction=function(o){return arguments.length?(r.conf.onNodeMouseleaveFunction=o,s):r.conf.onNodeMouseleaveFunction},s.onNodeClickFunction=function(o){return arguments.length?(r.conf.onNodeClickFunction=o,s):r.conf.onNodeClickFunction},s.onNodeDblclickFunction=function(o){return arguments.length?(r.conf.onNodeDblclickFunction=o,s):r.conf.onNodeDblclickFunction},s.onNodeContextmenuFunction=function(o){return arguments.length?(r.conf.onNodeContextmenuFunction=o,s):r.conf.onNodeContextmenuFunction},s.onLassoStartFunction=function(o){return arguments.length?(r.conf.onLassoStartFunction=o,s):r.conf.onLassoStartFunction},s.onLassoEndFunction=function(o){return arguments.length?(r.conf.onLassoEndFunction=o,s):r.conf.onLassoEndFunction},s.sampleData=function(o){return arguments.length?(r.data.sampleData=o,s):r.data.sampleData},s.data=function(){return r.data.dataStringConverted},s.customize=function(o){return arguments.length?(r.conf.customize=o,r.status.graphStarted&&(r.conf.customize?r.tools.createCustomizeWizard():r.tools.removeCustomizeWizard()),s):r.conf.customize},s.debug=function(o){return arguments.length?(r.conf.debug=o,r.status.graphStarted&&(r.conf.debug?r.tools.createCustomizeLink():r.tools.removeCustomizeLink()),s):r.conf.debug},s.releaseFixedNodes=function(){return r.status.graphStarted&&r.nodes.each(function(o){o.fixed=0}),s},s.userAgent=function(){return r.conf.userAgent},s.inspect=function(){return r},s.version=function(){return r.version},r.conf.apexPluginId&&apex.jQuery("#"+r.dom.containerId).bind("apexrefresh",function(){s.start()}),s}